function rateUp(e,t){rate(e,t,"up")}function rateDown(e,t){rate(e,t,"down")}function rate(e,t,n){var a="/answer/"+e;jQuery.ajax({url:a,global:!1,type:"PUT",data:{answer:t,rate:n},success:function(e){$("#"+e._id).html(e.useful),io.emit("answer-rated",{answeredBy:e.user}),updateCounts(),updateUserScore(!0)}})}function onEditAnswerClicked(e,t){$("#editAnswerModal").modal(),$.ajax({url:"/question/"+e,global:!1}).done(function(e){openEditAnswerPopup(e,t)})}function openEditAnswerPopup(e,t){var n=$(".textarea","#editAnswerModal");n.wysiwyg();var a=_.where(e.solutions,{_id:t});n.html(_.first(a).content),$(".edit-question-btn-save").on("click",function(){_.each(e.solutions,function(e){e._id==t&&(e.content=$(".textarea","#editAnswerModal").html())}),updateQuestion({id:e._id,solutions:e.solutions},onEditAnswerCompleted)})}function onDeleteAnswerClicked(e,t){var n="/answer/"+e;jQuery.ajax({url:n,global:!1,type:"DELETE",data:{answer:t},success:function(){updateCounts(),dispatchRefreshQuestions()}})}function answer(){var e=$(".list-group-item-question.active"),t=e.data("id"),n="/question/"+t;$.get(n,function(t){t.solutions.push({content:$(".textarea",e).html()}),registerAnswer(t)})}function registerAnswer(e){var t=$(".list-group-item-question.active");e.read=!1;var n=t.data("id"),a="/question/"+n;jQuery.ajax({url:a,type:"PUT",data:e,success:function(e){$(".textarea",t).html(""),t.removeClass("active"),$(".answer-collapsible.in").collapse("toggle");var n=e.question;io.emit("question-answered",{user:$("#user-name").val(),question:{id:n._id,type:n.type,createdBy:n.user.username,updatedBy:e.updatedBy}}),updateCounts(),dispatchRefreshQuestions()}})}function onEditAnswerCompleted(){onEditCompleted("#editAnswerModal")}var AnswersBox=React.createClass({displayName:"AnswersBox",render:function(){return React.createElement("div",{className:"answer-collapsible collapse",id:"answer-for-"+this.props.questionForAnswer.id},React.createElement(AnswerList,{questionForAnswer:this.props.questionForAnswer}),React.createElement(AnswerPanel,null))}}),AnswerList=React.createClass({displayName:"AnswerList",render:function(){var e=this.props.questionForAnswer.id,t=this.props.questionForAnswer.answers.map(function(t){var n={questionId:e,data:t};return React.createElement(Answer,{key:t._id,answer:n})});return React.createElement("div",{className:"list-group-answers"},t)}}),Answer=React.createClass({displayName:"Answer",render:function(){return React.createElement("div",{className:"list-group"},React.createElement("div",{"data-id":this.props.answer.data._id,className:"list-group-item list-group-item-answer"},React.createElement(AnswerRating,{answer:this.props.answer}),React.createElement(AnswerActions,{answer:this.props.answer}),React.createElement(AnswerContent,{answer:this.props.answer})))}}),AnswerRating=React.createClass({displayName:"AnswerRating",handleThumbUp:function(e){rateUp(e.questionId.toString(),e.data._id.toString())},handleThumbDown:function(e){rateDown(e.questionId.toString(),e.data._id.toString())},render:function(){var e={"float":"right"};return React.createElement("div",{style:e},React.createElement("span",{onClick:this.handleThumbDown.bind(this,this.props.answer),className:"glyphicon glyphicon-thumbs-down thumbs trigger-action"}),React.createElement("span",{id:this.props.answer.data._id,className:"badge rate-badge"},this.props.answer.data.useful),React.createElement("span",{onClick:this.handleThumbUp.bind(this,this.props.answer),className:"glyphicon glyphicon-thumbs-up thumbs"}))}}),AnswerActions=React.createClass({displayName:"AnswerActions",onAnswerEditClicked:function(e,t){onEditAnswerClicked(e.questionId.toString(),e.data._id.toString()),$(t.currentTarget).closest(".list-group-item-answer").addClass("selected")},onAnswerDeleteClicked:function(e){onDeleteAnswerClicked(e.questionId.toString(),e.data._id.toString())},render:function(){var e=this.props.answer,t=e.data.user&&e.data.user.google?e.data.user.google.picture:"img/unknown.png",n=e.data.user.username==$("#user-name").val(),a={"float":"left"};return React.createElement("div",{style:a},React.createElement(If,{condition:n},React.createElement("span",{"data-toggle":"modal",onClick:this.onAnswerEditClicked.bind(this,e),"data-target":"#editAnswerModal",className:"glyphicon glyphicon-pencil"})),React.createElement(If,{condition:n},React.createElement("span",{"data-toggle":"modal",onClick:this.onAnswerDeleteClicked.bind(this,e),className:"glyphicon glyphicon-trash"})),React.createElement("img",{"data-toggle":"dropdown",className:"no-collapse img-responsive answer-user beautify-tooltip img-circle",src:t,alt:""}))}}),AnswerContent=React.createClass({displayName:"AnswerContent",render:function(){var e=this.props.answer.data;return React.createElement("div",null,React.createElement("label",{className:"list-group-item-heading"},e.user.username+" "+toDateTime(e.created)),React.createElement("p",{className:"list-group-item-text",dangerouslySetInnerHTML:{__html:e.content}}))}}),AnswerPanel=React.createClass({displayName:"AnswerPanel",handleAnswerClick:function(){answer()},render:function(){return React.createElement("div",{className:"panel-answer"},React.createElement("div",{className:"textarea","data-ph":"Your answer goes here...",contenteditable:"true"}),React.createElement("div",{className:"panel-bottom-answer"},React.createElement("button",{onClick:this.handleAnswerClick,className:"btn btn-default btn-answer",type:"submit"},i18n.t("main-page.question-panel.register"))))}});
var DashboardBox=React.createClass({displayName:"DashboardBox",render:function(){return React.createElement("div",{id:"dashboard-box"},React.createElement(DashboardContent,{data:this.props.data}),React.createElement(DashboardRank,{users:this.props.data.users}))}}),DashboardContent=React.createClass({displayName:"DashboardContent",buildTagsPanel:function(e){return 0==e.length?React.createElement("h6",null,"No items to show"):e.map(function(e){return React.createElement(Tag,{tag:e})},this)},render:function(){var e={paddingBottom:"17px;"};return React.createElement("div",{id:"dashboard-content"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-lg-9 col-sm-8"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"Overall question data")),React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-warning"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.sinceFirstRelease)),React.createElement("div",{className:"panel-body text-center"},"Since Knowhow release"))),React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-success"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.lastMonthQuestions)),React.createElement("div",{className:"panel-body text-center"},"Last month questions"))),React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-info"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.helpedPeople)),React.createElement("div",{className:"panel-body text-center"},"Helped people :)")))))),React.createElement("div",{className:"col-lg-3 col-sm-4"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"More asked tags"),React.createElement("div",{className:"panel-actions"},React.createElement("a",{href:"index.html#",className:"btn-setting"},React.createElement("i",{className:"icon-settings"})),React.createElement("a",{href:"index.html#",className:"btn-minimize"},React.createElement("i",{className:"icon-arrow-up"})),React.createElement("a",{href:"index.html#",className:"btn-close"},React.createElement("i",{className:"icon-close"})))),React.createElement("div",{className:"panel-body",style:e},React.createElement(DashboardTags,{tags:this.props.data.tags}))))))}}),DashboardTags=React.createClass({displayName:"DashboardTags",render:function(){var e=this.props.tags.map(function(e){return React.createElement("div",{className:"token searched-tag"},React.createElement("span",{className:"token-label"},e._id+" ("+e.count+")"))});return React.createElement("div",{className:"tags collapsible-element"},e)}}),DashboardRank=React.createClass({displayName:"DashboardRank",render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-lg-12 col-sm-8"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"Ranking")),React.createElement(DashboardRankTable,{users:this.props.users}))))}}),DashboardRankTable=React.createClass({displayName:"DashboardRankTable",render:function(){var e=this.props.users.map(function(e){return React.createElement("tr",null,React.createElement("td",{className:"h2 description"},e.position),React.createElement("td",{className:"description"},React.createElement("img",{className:"img-circle img-ranking",src:e.photo,alt:""}),React.createElement("span",{className:"h4"},e.name)),React.createElement("td",{className:"h2 description"},React.createElement("span",{className:"sucess points"},e.points)))});return React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-striped"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null),React.createElement("th",null),React.createElement("th",null,"Points"))),React.createElement("tbody",null,e)))}});
function range(e,t){arguments.length<=1&&(t=e||0,e=0);for(var a=Math.max(t-e,0),n=0,i=new Array(a);a>n;)i[n++]=e,e+=1;return i}var dom=React.DOM,Paginator=React.createClass({displayName:"Paginator",getDefaultProps:function(){return{maxPages:3}},getInitialState:function(){return{page:1}},onClick:function(e){e>this.props.numPages||1>e||(this.props.onClick&&this.props.onClick(e),this.setState({page:e}))},getDisplayCount:function(){return this.props.numPages>this.props.maxPages?this.props.maxPages:this.props.numPages},getPageRange:function(){var e=this.getDisplayCount(),t=this.state.page,a=(t-1)%e,n=t-a,i=this.props.numPages-t;return t>e&&e>i&&(n=this.props.numPages-e+1),range(n,n+e)},preventDefault:function(e){e.preventDefault()},render:function(){var e=this.state.page,t=1===e?"disabled":"",a=e>=this.props.numPages?"disabled":"";return React.DOM.ul({className:"pagination"},React.DOM.li({className:t,onClick:this.onClick.bind(this,e-1)},React.DOM.a({href:"#",onClick:this.preventDefault},React.DOM.i({className:"glyphicon glyphicon-chevron-left"}))),this.getPageRange().map(this.renderPage,this),React.DOM.li({className:a,onClick:this.onClick.bind(this,e+1)},React.DOM.a({href:"#",onClick:this.preventDefault},React.DOM.i({className:"glyphicon glyphicon-chevron-right"}))))},renderPage:function(e,t){var a=this.state.page===e?"active":"";return React.DOM.li({key:t,className:a,onClick:this.onClick.bind(this,e)},React.DOM.a({href:"#",onClick:this.preventDefault},e))}});React.renderComponent(React.createElement(Paginator,{maxPages:"3",numPages:"5"}),document.querySelector("#pagination"));
function getQuestionMade(){return $("#main-navbar").next("div.popover.in").length?{content:$(".detailed-question").html(),tags:$(".detailed-question-popover .tokenfield").length?tidyTagsUp($(".detailed-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}:{content:$("#question").val(),tags:$(".simple-question-popover .tokenfield").length?tidyTagsUp($(".simple-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}}function dispatchRefreshQuestions(){var e=document.createEvent("Event");e.initEvent("refreshQuestions",!0,!0),document.dispatchEvent(e)}var QuestionsBox=React.createClass({displayName:"QuestionsBox",getInitialState:function(){return{data:[],page:1,textSearch:!1,renderDashboard:!1}},refreshQuestions:function(e,t){console.log(this.state.page),$.ajax({url:"/questions/outstandingFilter"+location.search,dataType:"json",data:{searchType:e,page:this.state.page},success:function(e){var a=t?e.records:this.state.data.concat(e.records);this.setState({data:a,renderDashboard:!1}),this.state.page++,this.hasMoreItems(e.pagination.totalPages),handleListGroup(),NProgress.done(),attachClipboardEvent()}.bind(this),error:function(e,t,a){console.error(this.props.url,t,a.toString())}.bind(this)})},hasMoreItems:function(e){this.state.hasMore=this.state.page<=e+1},componentDidMount:function(){window.addEventListener("scroll",this.handleScroll),document.getElementById("main-menu").addEventListener("click",this.handleMainMenuClick),document.addEventListener("refreshQuestions",this.restartData),document.getElementById("question").addEventListener("keyup",this.handleQuestionKeyUp),$("#accordion").delegate(".btn-answer","click",this.handleQuestionAnswered);var e=getParameterByName("id")?"search-by-id":"outstanding-questions";this.refreshQuestions(e)},handleQuestionKeyUp:function(){return this.state.page=1,this.state.textSearch=!0,$.xhrPool.length&&$.xhrPool.abortAll(),""==getQuestionTrimmed()?($(".nav-sidebar").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active"),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden"),$(".searched-tag").removeClass("searched-tag"),void this.restartData()):($("i.glyphicon-search").addClass("hidden"),$("img.icon-loading ").removeClass("hidden"),void this.refreshQuestionsBySearch(!0))},refreshQuestionsBySearch:function(e){$(".nav-sidebar").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active");var t=$.ajax({url:"/question/search",data:buildSearchData(this.state.page),global:!1}).success(function(t){var a=e?t.records:this.state.data.concat(t.records);handleListGroup(),this.setState({data:a,renderDashboard:!1}),this.state.page++,this.hasMoreItems(t.pagination.totalPages),NProgress.done(),attachClipboardEvent(),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden");var s=getTags();jQuery.ajax({url:"/addSearchCount",type:"PUT",global:!1});for(var n=0;n<s.length;n++)$(".tags").find(".token-label").filter(function(){var e=$(this).attr("class");return $(this).attr("class",e.toLowerCase()),$(this).hasClass(s[n].replace(/\s/g,"-"))}).addClass("searched-tag")}.bind(this)).error(function(){});$.xhrPool.push(t)},handleScroll:function(){!this.state.renderDashboard&&$(window).scrollTop()+$(window).height()>=$(document).height()-100&&this.state.hasMore&&(this.state.textSearch?this.refreshQuestionsBySearch(!1):this.refreshQuestions($("#main-menu li.active a").attr("id"),!1))},handleMainMenuClick:function(){$("#example").height(100),this.state.textSearch=!1,"dashboard"==$("#main-menu li.active a").attr("id")?this.handleDashboard():this.restartData()},handleDashboard:function(){$.ajax({url:"/dashboard",dataType:"json",success:function(e){this.setState({data:e,renderDashboard:!0}),NProgress.done()}.bind(this),error:function(e,t,a){console.error(this.props.url,t,a.toString())}.bind(this)})},restartData:function(){this.state.page=1,this.refreshQuestions($("#main-menu li.active a").attr("id"),!0)},render:function(){return React.createElement("div",null,React.createElement(If,{condition:!this.state.renderDashboard},React.createElement("div",{onScroll:this.handleScroll,id:"accordion"},React.createElement(QuestionList,{questions:this.state.data}),React.createElement("div",{className:"loading-modal"}))),React.createElement(If,{condition:this.state.renderDashboard},React.createElement(DashboardBox,{data:this.state.data})))}}),QuestionList=React.createClass({displayName:"QuestionList",render:function(){var e=this.props.questions.map(function(e){return React.createElement(Question,{key:e._id,question:e})},this);return React.createElement("div",{className:"list-group-questions"},e)}}),Question=React.createClass({displayName:"Question",toggle:function(e){$(e.target).hasClass("collapsible-element")&&$(e.currentTarget).children(".answer-collapsible").collapse("toggle")},render:function(){var e={id:this.props.question._id,answers:this.props.question.solutions};return React.createElement("div",{onClick:this.toggle,className:"collapsible-element list-group-item list-group-item-question","data-id":this.props.question._id,"data-parent":"#accordion","data-toggle":"collapse"},React.createElement(QuestionBy,{question:this.props.question}),React.createElement(QuestionActions,{question:this.props.question}),React.createElement(QuestionContent,{content:this.props.question.content}),React.createElement(QuestionSubContent,{question:this.props.question}),React.createElement(AnswersBox,{questionForAnswer:e}))}}),QuestionActions=React.createClass({displayName:"QuestionActions",handleQuestionEditClicked:function(e){openEditQuestionPopup(e)},handleQuestionDeleteClicked:function(e){deleteQuestion(e)},render:function(){var e={"float":"left"},t=this.props.question.user.username==$("#user-name").val();return React.createElement("div",{style:e},React.createElement("span",{className:"no-collapse glyphicon glyphicon-share-alt clip question-action-copy beautify-tooltip",onclick:"onCommentClicked()","data-placement":"right",title:"Copy to clipboard"}),React.createElement(If,{condition:t},React.createElement("span",{className:"no-collapse glyphicon glyphicon-pencil beautify-tooltip",onClick:this.handleQuestionEditClicked.bind(this,this.props.question._id),"data-placement":"right",title:"Edit this question?"})),React.createElement(If,{condition:t},React.createElement("span",{className:"no-collapse glyphicon glyphicon-trash beautify-tooltip","data-placement":"right",title:"Delete this question?",onClick:this.handleQuestionDeleteClicked.bind(this,this.props.question._id)})))}}),QuestionBy=React.createClass({displayName:"QuestionBy",render:function(){var e=this.props.question,t=e.updated?new Date(e.updated).getTime():new Date(e.created).getTime(),a=e.user.google?e.user.google.picture:"img/unknown.png",s={"margin-top":"5px","float":"left","margin-right":"5px"};return React.createElement("div",{className:"navbar-right"},React.createElement("span",{className:"no-collapse label pointer label-success beautify-tooltip",style:s,title:"Created in: "+toDateTime(e.created),"data-placement":"left"},getLastUpdate(t)),React.createElement("img",{"data-toggle":"dropdown",className:"no-collapse img-responsive panel-user beautify-tooltip img-circle",src:a,alt:"","data-placement":"left",title:e.user.username,"data-original-title":"Tooltip on left"}))}}),QuestionContent=React.createClass({displayName:"QuestionContent",render:function(){return React.createElement("h4",{className:"list-group-item-heading collapsible-element",dangerouslySetInnerHTML:{__html:this.props.content}})}}),QuestionSubContent=React.createClass({displayName:"QuestionSubContent",render:function(){var e=this.props.question;return e.tags&&e.tags.length?React.createElement(QuestionTags,{tags:e.tags}):e.solutions.length?React.createElement("p",{className:"list-group-item-text answer-preview-text collapsible-element"},getShortAnswers(e.solutions)):React.createElement("br",{className:"collapsible-element"})}}),QuestionTags=React.createClass({displayName:"QuestionTags",render:function(){var e=this.props.tags.map(function(e){return React.createElement("div",{className:"token Tryout"},React.createElement("span",{className:"token-label "+e.replace(/\s/g,"-")},e))});return React.createElement("div",{className:"tags collapsible-element"},e)}}),If=React.createClass({displayName:"If",render:function(){return this.props.condition?this.props.children:!1}});React.render(React.createElement(QuestionsBox,{url:"/question"}),document.getElementById("example"));