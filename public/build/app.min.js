$(document).ready(function(){$("a[data-confirm]").click(function(){var a=$(this).attr("href");return $("#dataConfirmModal").length||$("body").append('<div id="dataConfirmModal" class="modal fade">   <div class="modal-dialog">     <div class="modal-content">       <div class="modal-header">         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>         <h4 class="modal-title">Confirm</h4>       </div>       <div class="modal-body"></div>       <div class="modal-footer">        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>        <a class="btn btn-primary" id="dataConfirmOK">OK</a>       </div>     </div>   </div> </div>'),$("#dataConfirmModal").find(".modal-body").text($(this).attr("data-confirm")),$("#dataConfirmOK").attr("href",a),$("#dataConfirmModal").modal({show:!0}),!1}),$("form[data-confirm]").submit(function(){if($("#dataConfirmModal").is(":visible"))return!0;var a=$(this);return $("#dataConfirmModal").length||$("body").append('<div id="dataConfirmModal" class="modal fade">   <div class="modal-dialog">     <div class="modal-content">       <div class="modal-header">         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>         <h4 class="modal-title">Confirm</h4>       </div>       <div class="modal-body"></div>       <div class="modal-footer">        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>        <a class="btn btn-primary" id="dataConfirmOK">OK</a>       </div>     </div>   </div> </div>'),$("#dataConfirmModal").find(".modal-body").text($(this).attr("data-confirm")),$("#dataConfirmOK").click(function(){a.submit()}),$("#dataConfirmModal").modal({show:!0}),!1}),$("#add-position").click(function(){var a=$("#positionsStr").val(),t=$("#position").val(),d=$("#translate").is(":checked"),i='<input type="button" class="remove-position" />';$("#positions tbody").append("<tr><td>"+t+"</td><td>"+d+"</td><td>"+i+"</td></tr>"),a+="%%"+t+"^"+d,$("#position").val(""),$("#translate").attr("checked",!1),$("#positionsStr").val(a)}),$("#positions").on("click",".remove-position",function(){$(this).parents("tr").remove()})});
function toDateTime(e){if(void 0==e)return"";var t=new Date(e);return void 0==t?"":padLeft(t.getDate())+"/"+padLeft(t.getMonth())+"/"+t.getFullYear()+" "+padLeft(t.getHours())+":"+padLeft(t.getMinutes())}function padLeft(e,t,n){void 0==t&&(t="0"),void 0==n&&(n="2");for(var i="",o=0;n>o;o++)i+=t;return i.substring(0,i.length-e.toString().length)+e}function setupAjax(){$.ajaxSetup({complete:function(e){var t=$.xhrPool.indexOf(e);t>-1&&$.xhrPool.splice(t,1)}}),$(document).ajaxStart(function(){$("#accordion").addClass("loading"),NProgress.inc()}).ajaxStop(function(){$("#accordion").removeClass("loading"),NProgress.done()}).ajaxError(function(e,t,n,i){"Not Found"==i&&(window.location="/")})}function initializeTags(){updateTags(function(e){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:e.ttAdapter()}]})})}function initializeClosePopoverOut(){$("html").on("click",function(e){"popover"!==$(e.target).data("toggle")&&0===$(e.target).parents('[data-toggle="popover"]').length&&0===$(e.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")})}function initializeSidebar(){$(".sidebar a").on("click",sidebarClicked)}function initializeIo(){io=io.connect(),io.on("update-counts",function(){$(".answer-collapsible.in").length||""!=getQuestionTrimmed()||$("#outstandingQuestionsByUser").hasClass("questions-selected")||dispatchRefreshQuestions(),updateCounts()}),io.on("answer-rated",function(e){e.answeredBy._id==$("#user-id").val()&&updateUserScore(!0),updateCounts()}),io.on("question-created",function(e){var t="New question created in the section ["+e.type+"] by "+e.user;notificate(t,e.question,e.icon)}),io.on("question-answered",function(e){var t="Question made by "+e.question.createdBy+" answered in the section ["+e.question.type+"] by "+e.user;e.question.createdBy==$("#user-name").val()&&(t="Your question has been answered by "+e.question.updatedBy.username),notificate(t,e.question,e.question.updatedBy.google?e.question.updatedBy.google.picture:"")})}function handleMultiSelect(){var e=$("#filter").val().split(","),t=$("#systems");initMultiSelect(t),t.val(e),t.multiselect("refresh")}function initMultiSelect(e){e.multiselect({buttonWidth:"100%",buttonClass:"btn btn-link",nonSelectedText:i18n.t("main-page.header.system-select"),onChange:systemChanged})}function systemChanged(){jQuery.ajax({url:"/updateFilter",type:"PUT",global:!1,data:{filter:$("#systems").val()},success:function(){console.log("sucess"),$("#filter").val($("#systems").val()),initiateSearch(),updateCounts(),dispatchRefreshQuestions()}})}function initializeControls(){$("#question").focus(),$("#btn-ask").popover({html:!0}),$("body").tooltip({selector:".beautify-tooltip"}),$("body").tooltip({selector:"#group-ask",title:"ai ai"}),$("body").on("hidden.bs.popover",function(){$(".popover:not(.in)").hide().detach()}),$(".notifications span").tooltip()}function processPasteEvent(e){for(var t=0;t<e.clipboardData.items.length;t++){var n=e.clipboardData.items[t],i=n.type;if(-1!=i.indexOf("image")){var o=n.getAsFile(),a=new FileReader;a.onload=function(e){uploadAttachment(e.target.result,cleanTextArea)},insertLoadingTextarea(),a.readAsDataURL(o)}else console.log("Not supported: "+i)}}function downloadFile(){jQuery.ajax({type:"POST",url:"/download",global:!1}).done(function(){})}function insertLoadingTextarea(){doInsert($(document.createElement("div")).html('<img class="icon-loading" src="/img/loading.gif" style="display: block;">')[0])}function uploadAttachment(e,t,n){jQuery.ajax({url:"upload",type:"POST",global:!1,data:{img:e},success:function(e){var i;if("png"==e.ext||"jpg"==e.ext||"jpeg"==e.ext)i=new Image,i.className="img-responsive",i.src=e.src;else{var o=n.substr(0,n.lastIndexOf("."))||n,a='<button contenteditable="false"  class="attachment-button" type="button" onclick="window.open(\'/download?filename='+o+"&src="+e.fileName+'\',\'_top\'); return false;"><a class="en-ignore" href="/download?filename='+o+"&src="+e.fileName+'" target="_blank"><img border="0" name="26e5ab31-64b1-4513-af11-a1f5610ba81d" src="img/attachment.png" align="left" style="margin-top: -1px;"> '+n+"</a></button>";i=$(document.createElement("div")).html(a)[0]}doInsert(i),t&&t()},error:function(){}})}function HandleSelectionChange(){var e=window.getSelection&&window.getSelection();e&&e.rangeCount>0&&(savedRange=e.getRangeAt(0))}function doInsert(e){var t=window.getSelection&&window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(0);n.insertNode(e)}}function drop(e){ignoreDrag(e);var t=e.originalEvent.dataTransfer,n=t.files;if(t.files.length>0){var i=n[0],o=new FileReader;o.onload=function(e){return function(t){uploadAttachment(t.target.result,cleanTextArea,e)}}(i.name),insertLoadingTextarea(),o.readAsDataURL(i,"test")}}function cleanTextArea(){for(var e=$(".textarea",".list-group-item-question.active"),t=e.find("img[src*=data], .icon-loading"),n=0;n<t.length;n++)t[n].remove()}function ignoreDrag(e){e.originalEvent.stopPropagation(),e.originalEvent.preventDefault()}function handleListGroup(){var e=$(".list-group-questions");e.delegate(".answer-collapsible","shown.bs.collapse",function(){var e=$(".textarea",$(".list-group-item-question.active"));e.wysiwyg(),e.off("drop").on("drop",drop),e.off("keyup").on("keyup",function(e){e.ctrlKey&&13==e.keyCode&&answer()}),e.eq(0).focus()}),e.delegate(".answer-collapsible","show.bs.collapse",function(){$("#accordion .in").collapse("hide");var e=$(".list-group-item-question.active");if(e.hasClass("list-group-item-highlighted")){{e.attr("style")}e.removeClass("list-group-item-highlighted");var t=e.data("id"),n="/question/updateRead/"+t;jQuery.ajax({url:n,global:!1,type:"PUT",success:function(){console.log("sucess"),updateCounts()}})}}),e.delegate(".list-group-item-question","click",function(e){var t=$(e.currentTarget).closest(".list-group-questions").children(".active");t.removeClass("active"),$(e.currentTarget).addClass("active")})}function openEditQuestionPopup(e){console.log(e),$("#edit-question-tokenfield").tokenfield(),$("#editQuestionModal").modal(),$(".tokenfield").tokenfield("destroy"),$(".tokenfield","#editQuestionModal").tokenfield("disable"),$.ajax({url:"/question/"+e,global:!1}).done(function(e){var t=$(".textarea","#editQuestionModal");t.wysiwyg(),t.html(e.content),updateTags(function(t){$("#edit-question-tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:t.ttAdapter()}]}),$(".tokenfield","#editQuestionModal").tokenfield("setTokens",e.tags)},e.tags),$(".tokenfield","#editQuestionModal").tokenfield("enable"),$(".edit-question-btn-save").on("click",function(){updateQuestion({id:e._id,read:e.read,content:$(".textarea","#editQuestionModal").html(),tags:tidyTagsUp($("#edit-question-tokenfield").tokenfield("getTokensList").split(",")),solutions:e.solutions},onEditQuestionCompleted)})})}function updateTags(e,t){$.ajax({url:"/tags",global:!1}).done(function(n){for(var i=[],o=0;o<n.length;o++)i.push({value:n[o].title});var a=new Bloodhound({local:i,datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.value)},queryTokenizer:Bloodhound.tokenizers.whitespace});a.initialize(),e(a,t)})}function finishTour(){var e="/finishTour/"+$("#user-id").val();jQuery.ajax({url:e,global:!1,type:"PUT",success:function(){console.log("sucess")}})}function refreshQuestions(){$.get("/question",function(e){$(".list-group-questions").html("");for(var t=e.data,n=0;n<t.length;n++)$(".list-group-questions").append(getQuestion(t[n]))})}function updatePagination(e){var t=$(".pagination");t.html("");for(var n=1;n<=e.totalPages;n++)t.append(e.currentPage==n?$("<li/>",{"class":"active"}).append('<a href="#">'+n+"</a></li>"):'<li><a href="#">'+n+"</a></li>")}function refreshQuestionsWith(e){var t=e.records,n=$(".pagination");n.html("");for(var i=1;i<=e.pagination.totalPages;i++)n.append(e.pagination.currentPage==i?$("<li/>",{"class":"active"}).append('<a href="#">'+i+"</a></li>"):'<li><a href="#">'+i+"</a></li>");$(".list-group-questions").html("");for(var i=0;i<t.length;i++)$(".list-group-questions").append(getQuestion(t[i]))}function attachClipboardEvent(){var e=new ZeroClipboard($(".clip"));e.on("ready",function(){e.on("copy",function(e){var t=e.clipboardData,n=$(e.target).closest(".list-group-item-question").data("id"),i=$(e.target).siblings(".list-group-item-heading").text().replace(/<img [^>]+>/g,"").replace(/<br>/g,""),o=Helper.getDomain();t.setData("text/plain",$.trim(i)+" "+o+"?id="+n)}),e.on("aftercopy",function(){showSimpleNotification("Question copied to clipboard.","img/copy-icon.png")})})}function sidebarClicked(){$(this).attr("id");if(searchFunction=getQuestionsByLink,!$(this).hasClass("active")){var e=$(this).parent().siblings(".active");e.removeClass("active"),$(this).parent().addClass("active")}$(".pagination").children(".active").removeClass("active"),getQuestionsByLink()}function getQuestionsByLink(e){var t=2;getOutstandingCountByFilter({filter:{criteria:{type:$("#systems").val()},page:t}},refreshQuestionsWith,e)}function getOutstandingCountByFilter(e,t,n){$.getJSON("/questions/outstandingFilter",e).done(function(e){n&&n({data:e.records})}).fail(function(){})}function updateBadge(e,t){var n="#"+e+" .label";$(n).length?$(n).text(t):$("#"+e).append('<span class="label label-primary">'+t+"</span>")}function updateBadges(e){updateBadge("my-questions",e.myQuestions),updateBadge("my-answered-questions",e.myAnsweredQuestions),updateBadge("my-outstanding-questions",e.myOutstandingQuestions),updateBadge("outstanding-questions",e.outstandingQuestions),updateBadge("answered-outstanding-questions",e.answeredOutstandingQuestions),updateBadge("all-questions",e.allQuestions)}function updateQuestion(e,t){var n="/question/"+e.id;jQuery.ajax({url:n,type:"PUT",data:e,success:function(){t()}})}function onEditQuestionCompleted(){onEditCompleted("#editQuestionModal")}function onEditAnswerCompleted(){onEditCompleted("#editAnswerModal")}function onEditCompleted(e){$(".tokenfield",e).tokenfield("setTokens",""),$(".textarea",e).html(""),$(e).modal("hide"),dispatchRefreshQuestions(),$(".edit-question-btn-save").off("click")}function ask(e){var t=getQuestionMade();return""==t?void alertUser("danger",i18n.t("main-page.messages.question-required")):$("#systems").val()?void jQuery.post("/question",{content:t.content,tags:t.tags,type:$("#systems").val()},function(t){alertUser("success",i18n.t("main-page.messages.question-successful")),$("#question").val(""),$(".token").remove(),$(".detailed-question").html(""),e&&$("#main-navbar").popover("hide"),$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),initiateSearch(),io.emit("question-created",{user:$("#user-name").val(),type:$("#systems").val(),question:{id:t._id,type:t.type},icon:$("#user-avatar").attr("src")}),updateCounts(),dispatchRefreshQuestions(),updateUserScore(!0),ga_event("Question","Ask","Question saved as outstading")}):void alertUser("danger",i18n.t("main-page.messages.system-required"))}function updateUserScore(e){$.ajax({url:"/score/"+$("#user-id").val(),global:!1}).done(function(t){updateScore(t.points);var n=t.points-$("#user-points").val();$("#user-points").val(t.points),e&&n>0&&showSimpleNotification("Congratulations, you have got "+n+" points.","img/star.png")})}function updateScore(e){$(".score").html(e)}function alertUser(e,t){var n=buildPanel(e,t);$(".alert-panel").append(n),setTimeout(function(){$(".alert",".alert-panel").fadeOut("slow")},2e3)}function buildPanel(e,t){var n=[];return n.push('<div class="alert alert-'+e+'">'),n.push('<a href="#" class="close" data-dismiss="alert">&times;</a>'),n.push(t),n.push("</div>"),n.join("")}function answer(){var e=$(".list-group-item-question.active"),t=e.data("id"),n="/question/"+t;$.get(n,function(t){t.solutions.push({content:$(".textarea",e).html()}),registerAnswer(t)})}function updateCounts(){$.ajax({url:"/counts",global:!1}).done(function(e){updateBadges(e.data)})}function initiateSearch(){$(".sidebar").children(".active").removeClass("active"),$("#outstanding-questions").parent().addClass("active");var e=$("li.active > a",".pagination").html();return""!=getParameterByName("id")?void getOutstandingCountByFilter({filter:{criteria:{_id:getParameterByName("id")},page:e}},refreshQuestionsWith):void 0}function registerAnswer(e){var t=$(".list-group-item-question.active");e.read=!1;var n=t.data("id"),i="/question/"+n;jQuery.ajax({url:i,type:"PUT",data:e,success:function(e){$(".textarea",t).html(""),t.removeClass("active"),$(".answer-collapsible.in").collapse("toggle");var n=e.question;io.emit("question-answered",{user:$("#user-name").val(),question:{id:n._id,type:n.type,createdBy:n.user.username,updatedBy:e.updatedBy}}),updateCounts(),dispatchRefreshQuestions()}})}function deleteQuestion(e){var t="/question/"+e;jQuery.ajax({url:t,type:"DELETE",success:function(){updateUserScore(!1),io.emit("update-counts"),updateCounts(),dispatchRefreshQuestions()}})}function dispatchRefreshQuestions(){var e=document.createEvent("Event");e.initEvent("refreshQuestions",!0,!0),document.dispatchEvent(e)}function showAnswer(){var e=$(".list-group-item-question.active").data("id"),t="/question/updateRead/"+e;jQuery.ajax({url:t,type:"PUT",success:function(){console.log("sucess")}});var n="/question/"+e;$.get(n,function(e){$("#answers").html("");for(var t=0;t<e.solutions.length;t++){var n='<div class="panel panel-default"><div class="panel-heading"><span class="badge">'+e.solutions[t].useful+"</span><label>"+e.solutions[t].user.username+"</label> "+toDateTime(e.solutions[t].created)+"<a onclick=\"rateUp('"+e.solutions[t]._id+'\')" class="answer-result green" href="#"><span class="glyphicon glyphicon-ok"></span></a></div><div class="panel-body">'+e.solutions[t].content+"</div></div>";$("#answers").append(n)}}),$(".answer-panel").fadeIn("slow")}function onDeleteAnswerClicked(e,t){var n="/answer/"+e;jQuery.ajax({url:n,global:!1,type:"DELETE",data:{answer:t},success:function(){updateCounts(),dispatchRefreshQuestions()}})}function getShortAnswers(e){for(var t="",n=0;n<e.length;n++)t+=$($.parseHTML(e[n].content)).text();var i="...";return t.length<=120&&(i=""),t.substr(0,120)+i}function getLastUpdate(e){var t=(new Date).getTime()-e;t/=1e3;var n=Math.floor(t%60);t/=60;var i=Math.floor(t%60);t/=60;var o=Math.floor(t%24),a=Math.floor(t/24);return a>0?a+" days":o>0&&24>o?o+" hours":i>0&&60>i?i+" minutes":n+" seconds"}function buildAnswerPanel(){var e=[];return e.push('<div class="panel-answer">'),e.push('<div class="textarea" data-ph="Your answer goes here..."></div>'),e.push('<div class="panel-bottom-answer">'),e.push('<button onclick="answer()" class="btn btn-default btn-answer" type="submit">Register</button>'),e.push("</div>"),e.push("</div>"),e.join("")}function buildQuestionPanel(){var e=[];return e.push('<div class="panel-detailed-question">'),e.push('<div class="detailed-question textarea" data-ph="Your question goes here..."></div>'),e.push('<div class="panel-bottom-question">'),e.push('<div class="input-group">'),e.push('<input type="text" id="tags" class="tokenfield" title="Tag here" class="form-control" placeholder="Press tab or enter to insert a new tag">'),e.push('<span class="input-group-btn"><button onclick="ask(true)" class="btn btn-info" type="submit">'+i18n.t("main-page.header.ask")+"</button></span>"),e.push("</div>"),e.push("</div>"),e.join("")}function buildTagPanel(){var e=[];return e.push('<div class="input-group">'),e.push('<input type="text" class="tokenfield" name="question" title="Tag here" class="form-control" placeholder="Press tab or enter to insert a new tag">'),e.push('<span class="input-group-btn"><button onclick="ask()" class="btn btn-info btn-ask">'+i18n.t("main-page.question-panel.register")+"?</button></span>"),e.push("</div>"),e.join("")}function getQuestionMade(){return $("#main-navbar").next("div.popover.in").length?{content:$(".detailed-question").html(),tags:$(".detailed-question-popover .tokenfield").length?tidyTagsUp($(".detailed-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}:{content:$("#question").val(),tags:$(".simple-question-popover .tokenfield").length?tidyTagsUp($(".simple-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}}function tidyTagsUp(e){for(var t=0;t<e.length;t++)e[t]=$.trim(e[t]);return e}function handleDetailedQuestionPopover(){var e=$("#main-navbar"),t=$("#question");e.on("hide.bs.popover",function(){$("#main-navbar").next().hasClass("popover")&&(t.removeAttr("disabled"),$("#btn-ask").removeAttr("disabled","disabled").addClass("btn-info").removeClass("btn-default"))}).on("shown.bs.popover",function(){$(".panel-detailed-question").is(":visible")&&$(".panel-detailed-question").closest(".popover.in").length&&(t.attr("disabled","disabled"),$("#btn-ask").attr("disabled","disabled").toggleClass("btn-info").toggleClass("btn-default"));var e=$(".detailed-question");e.wysiwyg(),""!=t.val()&&e.html(t.val()),e.focus(),e.keyup=void 0,e.keyup(function(e){window.event?event:e;return e.ctrlKey&&13==e.keyCode?void ask(!0):void 0})})}function configureEvents(){handleDetailedQuestionPopover(),$(".navbar-fixed-top").on("shown.bs.popover",function(){updateTags(function(e){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:e.ttAdapter()}]})})}),$("#question").keyup(function(e){var t=window.event?event:e;13==t.keyCode&&(tagging(),$(".btn-ask").focus())}),window.addEventListener("paste",processPasteEvent)}function requestPermission(){"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission(function(e){Notification.permission!==e&&(Notification.permission=e)})}function onNotificationClicked(e){$('[data-id="'+e+'"]').addClass("list-group-item-highlighted"),window.focus()}function notificate(e,t,n){"Notification"in window&&("granted"===Notification.permission?showNotification(e,t,n):"denied"!==Notification.permission&&Notification.requestPermission(function(i){"permission"in Notification||(Notification.permission=i),"granted"===i&&showNotification(e,t,n)}))}function showNotification(e,t,n){if($("#systems").val()==t.type){var i=new Notification(e,{icon:n});setTimeout(function(){i.close()},7e3),i.onclick=function(){onNotificationClicked(t.id)}}}function showSimpleNotification(e,t){if("Notification"in window){var n=new Notification(e,{icon:t});setTimeout(function(){n.close()},7e3),n.onclick=function(){onNotificationClicked(question.id)}}}function askDetailedQuestion(){var e=$("#main-navbar"),t=$("#nav-input-wonder").width();$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),createPopover("detailed-question-popover",e,buildQuestionPanel(t),t)}function tagging(){var e=$("#nav-input-wonder"),t=e.width();createPopover("simple-question-popover",$("#nav-input-wonder"),buildTagPanel(),t)}function createPopover(e,t,n,i){var o=i?'style="max-width : '+i+"px; width :"+i+'px"':"",a='<div class="'+e+' timePickerWrapper popover"'+o+">",s=[a,'<div class="arrow"></div>','<div class="popover-content">',"</div>","</div>"].join("");t.popover({content:n,template:s,placement:"bottom",html:!0,trigger:"manual"}),t.popover("toggle")}function getQuestionTrimmed(){return $.trim(getQuestionMade().content.replace(/<img [^>]+>/g,"").replace(/<br>/g,"")).replace(/ +/g," ").toLowerCase()}function getConditions(){var e=getQuestionTrimmed(),t=e.split(" "),n=Helper.ToRegexArray(t,"content"),i=Helper.ToRegexArray(t,"tags"),o=Helper.ToRegex(e);return[{content:o},{$and:n},{$or:i}]}function getTags(){var e=getQuestionTrimmed();return $.grep(e.split(" "),function(e){return e})}function buildSearchData(e){getConditions();return{filter:{criteria:{type:$("#systems").val(),$text:{$search:getQuestionTrimmed()}},projection:{score:{$meta:"textScore"}},page:e,orderby:{score:{$meta:"textScore"}}}}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function onCommentClicked(){this.event.stopPropagation()}var Helper={ToRegex:function(e,t,n){void 0==n&&(n="i");var i={$regex:e,$options:n};if(void 0==t)return i;var o={};return o[t]=i,o},ToRegexArray:function(e,t){var n=new Array(e.length);for(i=0;i<e.length;i++)n[i]=Helper.ToRegex(e[i],t);return n},getDomain:function(){var e=window.location.href;return e.substring(0,e.indexOf("/",e.indexOf("//")+2)+1)}};$(document).ready(function(){requestPermission(),setupAjax(),initializeTags(),i18n&&i18n.init(handleMultiSelect),initializeClosePopoverOut(),initializeSidebar(),initializeIo(),initializeControls(),configureEvents(),updateCounts(),initiateSearch()}),$.xhrPool=[],$.xhrPool.abortAll=function(){$(this).each(function(e,t){t.abort()}),$.xhrPool.length=0};
function ga_event(t,a,e){_gaq.push(["_trackEvent",t,a,e]),console.log("*********** Tracking event: "+t+", "+a+", "+e)}var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-54929836-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a),$("*[data-gacategory]").each(function(){var t=$(this).data("gacategory"),a=$(this).data("gaaction"),e=$(this).data("galabel"),c="click";"SELECT"==$(this).prop("tagName")&&(c="change"),$(this).on(c,function(){ga_event(t,a,e)})})}();
function toDateTime(e){if(void 0==e)return"";var t=new Date(e);return void 0==t?"":padLeft(t.getDate())+"/"+padLeft(t.getMonth())+"/"+t.getFullYear()+" "+padLeft(t.getHours())+":"+padLeft(t.getMinutes())}function padLeft(e,t,n){void 0==t&&(t="0"),void 0==n&&(n="2");for(var i="",a=0;n>a;a++)i+=t;return i.substring(0,i.length-e.toString().length)+e}function processPasteEvent(e){for(var t=0;t<e.clipboardData.items.length;t++){var n=e.clipboardData.items[t],i=n.type;if(-1!=i.indexOf("image")){var a=n.getAsFile(),s=new FileReader;s.onload=function(e){uploadAttachment(e.target.result,cleanTextArea)},insertLoadingTextarea(),s.readAsDataURL(a)}else console.log("Not supported: "+i)}}function downloadFile(){jQuery.ajax({type:"POST",url:"/download",global:!1}).done(function(){})}function insertLoadingTextarea(){doInsert($(document.createElement("div")).html('<img class="icon-loading" src="/img/loading.gif" style="display: block;">')[0])}function uploadAttachment(e,t,n){jQuery.ajax({url:"upload",type:"POST",global:!1,data:{img:e},success:function(e){var i;if("png"==e.ext||"jpg"==e.ext||"jpeg"==e.ext)i=new Image,i.src=e.src;else{var a=n.substr(0,n.lastIndexOf("."))||n,s='<button contenteditable="false"  class="attachment-button" type="button" onclick="window.open(\'/download?filename='+a+"&src="+e.fileName+'\',\'_top\'); return false;"><a class="en-ignore" href="/download?filename='+a+"&src="+e.fileName+'" target="_blank"><img border="0" name="26e5ab31-64b1-4513-af11-a1f5610ba81d" src="img/attachment.png" align="left" style="margin-top: -1px;"> '+n+"</a></button>";i=$(document.createElement("div")).html(s)[0]}doInsert(i),t&&t()},error:function(){}})}function HandleSelectionChange(){var e=window.getSelection&&window.getSelection();e&&e.rangeCount>0&&(savedRange=e.getRangeAt(0))}function doInsert(e){var t=window.getSelection&&window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(0);n.insertNode(e)}}function drop(e){ignoreDrag(e);var t=e.originalEvent.dataTransfer,n=t.files;if(t.files.length>0){var i=n[0],a=new FileReader;a.onload=function(e){return function(t){uploadAttachment(t.target.result,cleanTextArea,e)}}(i.name),insertLoadingTextarea(),a.readAsDataURL(i,"test")}}function cleanTextArea(){for(var e=$(".textarea",".list-group-item-question.active"),t=e.find("img[src*=data], .icon-loading"),n=0;n<t.length;n++)t[n].remove()}function ignoreDrag(e){e.originalEvent.stopPropagation(),e.originalEvent.preventDefault()}function handleListGroup(){var e=$(".list-group-questions");e.delegate(".answer-collapsible","click",function(e){e.stopPropagation()}),e.delegate("span","click",function(){}),e.delegate(".answer-collapsible","shown.bs.collapse",function(){var e=$(".textarea",$(".list-group-item-question.active"));e.wysiwyg(),e.off("drop").on("drop",drop),e.keyup(function(e){e.ctrlKey&&13==e.keyCode&&answer()}),e.eq(0).focus()}),e.delegate(".answer-collapsible","show.bs.collapse",function(){$("#accordion .in").collapse("hide");{var e=$(".list-group-item-question.active");e.attr("style")}e.removeClass("list-group-item-highlighted");var t=e.data("id"),n="/question/updateRead/"+t;jQuery.ajax({url:n,global:!1,type:"PUT",success:function(){console.log("sucess"),updateCounts()}})}),e.delegate(".list-group-item-question","click",function(e){var t=$(e.currentTarget).closest(".list-group-questions").children(".active");t.removeClass("active"),$(e.currentTarget).addClass("active")}),$(".pagination").delegate("a","click",paginationClicked)}function onEditAnswerClicked(e){this.event.stopPropagation(),$("#editAnswerModal").modal();var t=$(e).closest(".list-group-item-question").data("id");$(e).closest(".list-group-item-answer").addClass("selected"),$.ajax({url:"/question/"+t,global:!1}).done(function(e){var t=$(".textarea","#editAnswerModal");t.wysiwyg();var n=_.where(e.solutions,{_id:$(".list-group-item-answer.selected").data("id")});t.html(_.first(n).content),$(".edit-question-btn-save").on("click",function(){_.each(e.solutions,function(e){e._id==$(".list-group-item-answer.selected").data("id")&&(e.content=$(".textarea","#editAnswerModal").html())}),$(".list-group-item-answer.selected").removeClass("selected"),updateQuestion({id:e._id,solutions:e.solutions},onEditAnswerCompleted)})})}function onEditClicked(e){this.event.stopPropagation(),$("#edit-question-tokenfield").tokenfield(),$("#editQuestionModal").modal();var t=$(e).parent().data("id");$(".tokenfield").tokenfield("destroy"),$(".tokenfield","#editQuestionModal").tokenfield("disable"),$.ajax({url:"/question/"+t,global:!1}).done(function(e){var t=$(".textarea","#editQuestionModal");t.wysiwyg(),t.html(e.content),updateTags(function(t){$("#edit-question-tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:t.ttAdapter()}]}),$(".tokenfield","#editQuestionModal").tokenfield("setTokens",e.tags)},e.tags),$(".tokenfield","#editQuestionModal").tokenfield("enable"),$(".edit-question-btn-save").on("click",function(){updateQuestion({id:e._id,read:e.read,content:$(".textarea","#editQuestionModal").html(),tags:tidyTagsUp($("#edit-question-tokenfield").tokenfield("getTokensList").split(",")),solutions:e.solutions},onEditQuestionCompleted)})})}function updateTags(e,t){$.ajax({url:"/tags",global:!1}).done(function(n){for(var i=[],a=0;a<n.length;a++)i.push({value:n[a].title});var s=new Bloodhound({local:i,datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.value)},queryTokenizer:Bloodhound.tokenizers.whitespace});s.initialize(),e(s,t)})}function finishTour(){var e="/finishTour/"+$("#user-id").val();jQuery.ajax({url:e,global:!1,type:"PUT",success:function(){console.log("sucess")}})}function refreshQuestions(){$.get("/question",function(e){$(".list-group-questions").html("");for(var t=e.data,n=0;n<t.length;n++)$(".list-group-questions").append(getQuestion(t[n]))})}function refreshQuestionsWith(e){var t=e.records,n=$(".pagination");n.html("");for(var i=1;i<=e.pagination.totalPages;i++)n.append(e.pagination.currentPage==i?$("<li/>",{"class":"active"}).append('<a href="#">'+i+"</a></li>"):'<li><a href="#">'+i+"</a></li>");$(".list-group-questions").html("");for(var i=0;i<t.length;i++)$(".list-group-questions").append(getQuestion(t[i]));var a=new ZeroClipboard($(".clip"));a.on("ready",function(){a.on("copy",function(e){var t=e.clipboardData,n=$(e.target).parent().data("id"),i=$(e.target).siblings(".list-group-item-heading").text().replace(/<img [^>]+>/g,"").replace(/<br>/g,""),a=Helper.getDomain();t.setData("text/plain",$.trim(i)+" "+a+"?id="+n)}),a.on("aftercopy",function(){showSimpleNotification("Question copied to clipboard.","img/copy-icon.png")})})}function paginationClicked(){if(!$(this).hasClass("active")){var e=$(this).closest(".pagination").children(".active");e.removeClass("active"),$(this).parent().addClass("active")}searchFunction()}function sidebarClicked(){$(this).attr("id");if(searchFunction=getQuestionsByLink,!$(this).hasClass("active")){var e=$(this).closest(".side-nav").children(".active");e.removeClass("active"),$(this).parent().addClass("active")}$(".pagination").children(".active").removeClass("active"),getQuestionsByLink()}function getQuestionsByLink(){var e=$("li.active > a",".side-nav").attr("id"),t=$("li.active > a",".pagination").html();"my-questions"==e?getOutstandingCountByFilter({filter:{criteria:{user:!0,type:$("#systems").val()},page:t}},refreshQuestionsWith):"my-outstanding-questions"==e?getOutstandingCountByFilter({filter:{criteria:{$or:[{useful:0},{solutions:{$size:0}}],user:!0,type:$("#systems").val()},page:t}},refreshQuestionsWith):"my-answered-questions"==e?getOutstandingCountByFilter({filter:{criteria:{useful:{$gt:0},user:!0,type:$("#systems").val()},page:t}},refreshQuestionsWith):"outstanding-questions"==e?getOutstandingCountByFilter({filter:{criteria:{$or:[{"solutions.useful":0},{solutions:{$size:0}}],type:$("#systems").val()},page:t}},refreshQuestionsWith):"answered-outstanding-questions"==e?getOutstandingCountByFilter({filter:{criteria:{useful:{$gt:0},type:$("#systems").val()},page:t}},refreshQuestionsWith):"all-questions"==e&&getOutstandingCountByFilter({filter:{criteria:{type:$("#systems").val()},page:t}},refreshQuestionsWith)}function getOutstandingCountByFilter(e,t){$.getJSON("/questions/outstandingFilter",e).done(function(e){t(e)}).fail(function(){})}function updateBadge(e,t){var n="#"+e+" .badge";$(n).length?$(n).text(t):$("#"+e).append('<span class="badge" style="margin-left: 5px">'+t+"</span>")}function updateBadges(e){updateBadge("my-questions",e.myQuestions),updateBadge("my-answered-questions",e.myAnsweredQuestions),updateBadge("my-outstanding-questions",e.myOutstandingQuestions),updateBadge("outstanding-questions",e.outstandingQuestions),updateBadge("answered-outstanding-questions",e.answeredOutstandingQuestions),updateBadge("all-questions",e.allQuestions)}function updateQuestion(e,t){var n="/question/"+e.id;jQuery.ajax({url:n,type:"PUT",data:e,success:function(){t()}})}function onEditQuestionCompleted(){onEditCompleted("#editQuestionModal")}function onEditAnswerCompleted(){onEditCompleted("#editAnswerModal")}function onEditCompleted(e){$(".tokenfield",e).tokenfield("setTokens",""),$(".textarea",e).html(""),$(e).modal("hide"),searchFunction(),$(".edit-question-btn-save").off("click")}function ask(e){var t=getQuestionMade();return""==t?void alertUser("danger",i18n.t("main-page.messages.question-required")):$("#systems").val()?void jQuery.post("/question",{content:t.content,tags:t.tags,type:$("#systems").val()},function(t){alertUser("success",i18n.t("main-page.messages.question-successful")),$("#question").val(""),$(".token").remove(),$(".detailed-question").html(""),e&&$("#main-navbar").popover("hide"),$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),initiateSearch(),io.emit("question-created",{user:$("#user-name").val(),type:$("#systems").val(),question:{id:t._id,type:t.type},icon:$("#user-avatar").attr("src")}),updateCounts(),updateUserScore(!0),ga_event("Question","Ask","Question saved as outstading")}):void alertUser("danger",i18n.t("main-page.messages.system-required"))}function updateUserScore(e){$.ajax({url:"/score/"+$("#user-id").val(),global:!1}).done(function(t){updateScore(t.points);var n=t.points-$("#user-points").val();$("#user-points").val(t.points),e&&n>0&&showSimpleNotification("Congratulations, you have got "+n+" points.","img/star.png")})}function updateScore(e){$(".score").html(e)}function alertUser(e,t){var n=buildPanel(e,t);$(".alert-panel").append(n),setTimeout(function(){$(".alert",".alert-panel").fadeOut("slow")},2e3)}function buildPanel(e,t){var n=[];return n.push('<div class="alert alert-'+e+'">'),n.push('<a href="#" class="close" data-dismiss="alert">&times;</a>'),n.push(t),n.push("</div>"),n.join("")}function answer(){var e=$(".list-group-item-question.active"),t=e.data("id"),n="/question/"+t;$.get(n,function(t){t.solutions.push({content:$(".textarea",e).html()}),registerAnswer(t)})}function updateCounts(){$.ajax({url:"/counts",global:!1}).done(function(e){updateBadges(e.data)})}function initiateSearch(){$(".side-nav").children(".active").removeClass("active"),$("#outstanding-questions").parent().addClass("active");var e=$("li.active > a",".pagination").html();return searchFunction=getQuestionsByLink,""!=getParameterByName("id")?void getOutstandingCountByFilter({filter:{criteria:{_id:getParameterByName("id")},page:e}},refreshQuestionsWith):void getOutstandingCountByFilter({filter:{criteria:{$or:[{"solutions.useful":0},{solutions:{$size:0}}],type:$("#filter").val()},page:e}},refreshQuestionsWith)}function registerAnswer(e){var t=$(".list-group-item-question.active");e.read=!1;var n=t.data("id"),i="/question/"+n;jQuery.ajax({url:i,type:"PUT",data:e,success:function(e){$(".text-area-answer",t).val("");var n=e.question;io.emit("question-answered",{user:$("#user-name").val(),question:{id:n._id,type:n.type,createdBy:n.user.username,updatedBy:e.updatedBy}}),$.get("/counts",function(e){updateBadges(e.data)}),updateUserScore(!0),searchFunction()}})}function deleteQuestion(e){this.event.stopPropagation();var t="/question/"+e;jQuery.ajax({url:t,type:"DELETE",data:question,success:function(){updateUserScore(!1),searchFunction(),io.emit("update-counts")}})}function showAnswer(){var e=$(".list-group-item-question.active").data("id"),t="/question/updateRead/"+e;jQuery.ajax({url:t,type:"PUT",success:function(){console.log("sucess")}});var n="/question/"+e;$.get(n,function(e){$("#answers").html("");for(var t=0;t<e.solutions.length;t++){var n='<div class="panel panel-default"><div class="panel-heading"><span class="badge">'+e.solutions[t].useful+"</span><label>"+e.solutions[t].user.username+"</label> "+toDateTime(e.solutions[t].created)+"<a onclick=\"rateUp('"+e.solutions[t]._id+'\')" class="answer-result green" href="#"><span class="glyphicon glyphicon-ok"></span></a></div><div class="panel-body">'+e.solutions[t].content+"</div></div>";$("#answers").append(n)}}),$(".answer-panel").fadeIn("slow")}function rateUp(e){rate(e,"up")}function rateDown(e){rate(e,"down")}function rate(e,t){var n="/answer/"+$(".list-group-item-question.active").data("id");jQuery.ajax({url:n,global:!1,type:"PUT",data:{answer:e,rate:t},success:function(e){$("#"+e._id).html(e.useful),io.emit("answer-rated",{answeredBy:e.user}),updateCounts(),updateUserScore(!0)}})}function deleteAnswer(e){var t="/answer/"+$(".list-group-item-question.active").data("id");jQuery.ajax({url:t,global:!1,type:"DELETE",data:{answer:e},success:function(){updateCounts(),searchFunction()}})}function question(e,t,n){return"<a onclick=\"showAnswer('"+e+'\')" href="#" class="list-group-item-question "><h4 class="list-group-item-heading">'+t+'</h4><p class="list-group-item-text">'+n+"</p></a>"}function getShortAnswers(e){for(var t="",n=0;n<e.length;n++)t+=$($.parseHTML(e[n].content)).text();var i="...";return t.length<=120&&(i=""),t.substr(0,120)+i}function configureEventHandlers(){var e=$(".list-group-questions");e.delegate(".list-group-item-question","click",function(e){var t=$(e.currentTarget),n="/question/"+t.data("id");$.get(n,function(e){var n,i=t.find(".answers");i.html("");for(var a=0;a<e.solutions.length;a++)n=[],n.push('<div class="panel panel-default">'),n.push('    <div class="panel-heading">'),n.push('        <span class="badge">'+e.solutions[a].useful+"</span>"),n.push("        <label>"+e.solutions[a].user.username+"</label>"),n.push("        "+toDateTime(e.solutions[a].created)),n.push("        <a onclick=\"rateUp('"+e.solutions[a]._id+'\')" class="answer-result green" href="#">'),n.push('            <span class="glyphicon glyphicon-ok"></span>'),n.push("        </a>"),n.push("    </div>"),n.push('    <div class="panel-body">'),n.push("   "+e.solutions[a].content),n.push("    </div>"),n.push("</div>"),i.append(n.join(""))})})}function getLastUpdate(e){var t=(new Date).getTime()-e;t/=1e3;var n=Math.floor(t%60);t/=60;var i=Math.floor(t%60);t/=60;var a=Math.floor(t%24),s=Math.floor(t/24);return s>0?s+" days":a>0&&24>a?a+" hours":i>0&&60>i?i+" minutes":n+" seconds"}function getQuestion(e){var t=[],n="answer-for-"+e._id,i="";e.read||e.user.username==$("#user-name").val()&&(i="list-group-item-highlighted");var a=e.user.google?e.user.google.picture:"/img/unknown.png",s=e.updated?new Date(e.updated).getTime():new Date(e.created).getTime();if(t.push('<div data-target="#'+n+'" class="list-group-item list-group-item-question '+i+'" data-parent="#accordion" data-toggle="collapse" data-id="'+e._id+"\" onclick=\"ga_event('Question', 'Open-Question-"+e._id+"', 'Show details from question')\">"),t.push('<div class="navbar-right">'),t.push('<span class="label label-success" style="margin-top: 5px; float: left;margin-right: 5px">'+getLastUpdate(s)+"</span>"),t.push('<img data-toggle="dropdown" class="img-responsive panel-user img-circle" src="'+a+'" alt="" data-toggle="tooltip" data-placement="left" title="'+e.user.username+'" data-original-title="Tooltip on left"/>'),t.push("</div>"),t.push('<span class="glyphicon glyphicon-share-alt clip" onclick="onCommentClicked()" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;" title="Copy to clipboard"></span>'),e.user.username==$("#user-name").val()&&(t.push('<span data-toggle="modal" onclick="onEditClicked(this)" data-target="#editQuestionModal" class="glyphicon glyphicon-pencil" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),t.push("<span onclick=\"deleteQuestion('"+e._id+'\')" class="glyphicon glyphicon-trash" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>')),t.push('  <h4 class="list-group-item-heading">'+e.content+"</h4>"),e.tags.length){t.push('<div class="tags">');for(var o=0;o<e.tags.length;o++)t.push('<div class="token '+e.tags[o].replace(/\s/g,"-")+'"><span class="token-label" style="max-width: 941px;">'+e.tags[o]+" </span></div>");t.push("</div>")}else t.push(e.solutions.length?'  <p class="list-group-item-text answer-preview-text">'+getShortAnswers(e.solutions)+"</p>":"<br>");t.push('  <div class="answer-collapsible collapse"  id="'+n+'">');for(var o=0;o<e.solutions.length;o++)t.push('<div class="list-group">'),t.push('<div data-id="'+e.solutions[o]._id+'" class="list-group-item list-group-item-answer">'),t.push("<span onclick=\"rateDown('"+e.solutions[o]._id+'\')" class="glyphicon glyphicon-thumbs-down" style="float: right;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),t.push('<span id="'+e.solutions[o]._id+'" class="badge" style="margin-right: 5px">'+e.solutions[o].useful+"</span>"),t.push("<span onclick=\"rateUp('"+e.solutions[o]._id+'\')" class="glyphicon glyphicon-thumbs-up" style="float: right;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),e.solutions[o].user.username==$("#user-name").val()&&(t.push('<span data-toggle="modal" onclick="onEditAnswerClicked(this)" data-target="#editAnswerModal" class="glyphicon glyphicon-pencil" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),t.push('<span data-toggle="modal" onclick="deleteAnswer(\''+e.solutions[o]._id+'\')" class="glyphicon glyphicon-trash" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>')),t.push('<label class="list-group-item-heading">'+e.solutions[o].user.username+" "+toDateTime(e.solutions[o].created)+"</label>"),t.push('<p class="list-group-item-text">'+e.solutions[o].content+"</p>"),t.push("</div>"),t.push("</div>");"hours"!=$("#systems").val()&&"peopleCare"!=$("#systems").val()?t.push(buildAnswerPanel()):"administrative"==$("#department").val()&&t.push(buildAnswerPanel()),t.push("</div>"),t.push("</div>");t.join("");return t.join("")}function buildAnswerPanel(){var e=[];return e.push('<div class="panel-answer">'),e.push('<div class="textarea" data-ph="Your answer goes here..."></div>'),e.push('<div class="panel-bottom-answer">'),e.push('<button onclick="answer()" class="btn btn-default btn-answer" type="submit">Register</button>'),e.push("</div>"),e.push("</div>"),e.join("")}function buildQuestionPanel(){var e=[];return e.push('<div class="panel-detailed-question">'),e.push('<div class="detailed-question textarea" data-ph="Your question goes here..."></div>'),e.push('<div class="panel-bottom-question">'),e.push('<div class="input-group">'),e.push('<input type="text" id="tags" class="tokenfield" title="Tag here" class="form-control" placeholder="Tag here">'),e.push('<span class="input-group-btn"><button onclick="ask(true)" class="btn btn-info" type="submit">'+i18n.t("main-page.header.ask")+"</button></span>"),e.push("</div>"),e.push("</div>"),e.join("")}function buildTagPanel(){var e=[];return e.push('<div class="input-group">'),e.push('<input type="text" class="tokenfield" name="question" title="Tag here" class="form-control" placeholder="Tag here">'),e.push('<span class="input-group-btn"><button onclick="ask()" class="btn btn-info btn-ask">'+i18n.t("main-page.question-panel.register")+"?</button></span>"),e.push("</div>"),e.join("")}function handleCollapsibleAnswers(e){var t=$(e.currentTarget).parent(".list-group-item-question"),n=t.data("id"),i="/question/"+n;$.get(i,function(e){var n,i=t.find("#answer-for-"+e._id);i.html("");for(var a=0;a<e.solutions.length;a++)n=[],n.push('<div class="panel panel-default">'),n.push('    <div class="panel-heading">'),n.push('        <span class="badge">'+e.solutions[a].useful+"</span>"),n.push("        <label>"+e.solutions[a].user.username+"</label>"),n.push("        "+toDateTime(e.solutions[a].created)),n.push("        <a onclick=\"rateUp('"+e.solutions[a]._id+'\')" class="answer-result green" href="#">'),n.push('            <span class="glyphicon glyphicon-ok"></span>'),n.push("        </a>"),n.push("    </div>"),n.push('    <div class="panel-body">'),n.push("   "+e.solutions[a].content),n.push("    </div>"),n.push("</div>"),i.append(n.join(""))})}function getQuestionMade(){return $("#main-navbar").next("div.popover.in").length?{content:$(".detailed-question").html(),tags:$(".detailed-question-popover .tokenfield").length?tidyTagsUp($(".detailed-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}:{content:$("#question").val(),tags:$(".simple-question-popover .tokenfield").length?tidyTagsUp($(".simple-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}}function tidyTagsUp(e){for(var t=0;t<e.length;t++)e[t]=$.trim(e[t]);return e}function handleDetailedQuestionPopover(){var e=$("#main-navbar"),t=$("#question");e.on("hide.bs.popover",function(){$("#main-navbar").next().hasClass("popover")&&(t.removeAttr("disabled"),$("#btn-ask").removeAttr("disabled","disabled").addClass("btn-info").removeClass("btn-default"))}).on("shown.bs.popover",function(){$(".panel-detailed-question").is(":visible")&&$(".panel-detailed-question").closest(".popover.in").length&&(t.attr("disabled","disabled"),$("#btn-ask").attr("disabled","disabled").toggleClass("btn-info").toggleClass("btn-default"));var e=$(".detailed-question");e.wysiwyg(),""!=t.val()&&e.html(t.val()),e.focus(),e.keyup(function(e){window.event?event:e;return e.ctrlKey&&13==e.keyCode?void ask(!0):void getBySearch()})})}function configureEvents(){handleDetailedQuestionPopover(),$(".navbar-fixed-top").on("shown.bs.popover",function(){updateTags(function(e){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:e.ttAdapter()}]})})}),$("#question").keyup(function(e){var t=window.event?event:e;13==t.keyCode&&(tagging(),$(".btn-ask").focus()),searchFunction=getBySearch,getBySearch()})}function getBySearch(){""==$("#question").val()&&($(".side-nav").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active")),$.xhrPool.length&&$.xhrPool.abortAll(),$("i.glyphicon-search").addClass("hidden"),$("img.icon-loading ").removeClass("hidden");var e=$.ajax({url:"/question/search",data:buildSearchData(),global:!1}).done(function(e){refreshQuestionsWith(e),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden");var t=getTags();jQuery.ajax({url:"/addSearchCount",type:"PUT",global:!1});for(var n=0;n<t.length;n++)$(".tags").children().filter(function(){var e=$(this).attr("class");return $(this).attr("class",e.toLowerCase()),$(this).hasClass(t[n].replace(/\s/g,"-"))}).addClass("searched-tag")});$.xhrPool.push(e)}function requestPermission(){"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission(function(e){Notification.permission!==e&&(Notification.permission=e)})}function onNotificationClicked(e){$('[data-id="'+e+'"]').addClass("list-group-item-highlighted"),window.focus()}function notificate(e,t,n){"Notification"in window&&("granted"===Notification.permission?showNotification(e,t,n):"denied"!==Notification.permission&&Notification.requestPermission(function(i){"permission"in Notification||(Notification.permission=i),"granted"===i&&showNotification(e,t,n)}))}function showNotification(e,t,n){if($("#systems").val()==t.type){var i=new Notification(e,{icon:n});setTimeout(function(){i.close()},7e3),i.onclick=function(){onNotificationClicked(t.id)}}}function showSimpleNotification(e,t){if("Notification"in window){var n=new Notification(e,{icon:t});setTimeout(function(){n.close()},7e3),n.onclick=function(){onNotificationClicked(question.id)}}}function askDetailedQuestion(){var e=$("#main-navbar"),t=$("#nav-input-wonder").width();$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),createPopover("detailed-question-popover",e,buildQuestionPanel(t),t)}function tagging(){var e=$("#nav-input-wonder"),t=e.width();createPopover("simple-question-popover",$("#nav-input-wonder"),buildTagPanel(),t)}function createPopover(e,t,n,i){var a=i?'style="max-width : '+i+"px; width :"+i+'px"':"",s='<div class="'+e+' timePickerWrapper popover"'+a+">",o=[s,'<div class="arrow"></div>','<div class="popover-content">',"</div>","</div>"].join("");t.popover({content:n,template:o,placement:"bottom",html:!0,trigger:"manual"}),t.popover("toggle")}function getQuestionTrimmed(){return $.trim(getQuestionMade().content.replace(/<img [^>]+>/g,"").replace(/<br>/g,"")).replace(/ +/g," ").toLowerCase()}function getConditions(){var e=getQuestionTrimmed(),t=e.split(" "),n=Helper.ToRegexArray(t,"content"),i=Helper.ToRegexArray(t,"tags"),a=Helper.ToRegex(e);return[{content:a},{$and:n},{$or:i}]}function getTags(){var e=getQuestionTrimmed();return $.grep(e.split(" "),function(e){return e})}function buildSearchData(){var e=$("li.active > a",".pagination").html(),t=getConditions();return{filter:{criteria:{$or:t,type:$("#systems").val()},page:e,orderby:{useful:-1,updated:-1}}}}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function onCommentClicked(){this.event.stopPropagation()}var Helper={ToRegex:function(e,t,n){void 0==n&&(n="i");var i={$regex:e,$options:n};if(void 0==t)return i;var a={};return a[t]=i,a},ToRegexArray:function(e,t){var n=new Array(e.length);for(i=0;i<e.length;i++)n[i]=Helper.ToRegex(e[i],t);return n},getDomain:function(){var e=window.location.href;return e.substring(0,e.indexOf("/",e.indexOf("//")+2)+1)}};$(document).ready(function(){function e(){var e=$("#filter").val().split(","),n=$("#systems");t(n),n.val(e),n.multiselect("refresh")}function t(e){e.multiselect({buttonWidth:"100%",buttonClass:"btn btn-link",nonSelectedText:i18n.t("main-page.header.system-select"),onChange:n})}function n(){jQuery.ajax({url:"/updateFilter",type:"PUT",global:!1,data:{filter:$("#systems").val()},success:function(){console.log("sucess"),$("#filter").val($("#systems").val()),initiateSearch(),updateCounts()}})}requestPermission(),$.ajaxSetup({complete:function(e){var t=$.xhrPool.indexOf(e);t>-1&&$.xhrPool.splice(t,1)}}),$(document).ajaxStart(function(){$("#accordion").addClass("loading"),NProgress.inc()}).ajaxStop(function(){$("#accordion").removeClass("loading"),NProgress.done()}).ajaxError(function(e,t,n,i){"Not Found"==i&&(window.location="/")}),updateTags(function(e){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:e.ttAdapter()}]})}),i18n&&i18n.init(e),$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("active")}),$("html").on("click",function(e){"popover"!==$(e.target).data("toggle")&&0===$(e.target).parents('[data-toggle="popover"]').length&&0===$(e.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")}),$(".side-nav a").on("click",sidebarClicked),io=io.connect(),io.on("update-counts",function(){$(".answer-collapsible.in").length||""!=getQuestionTrimmed()||$("#outstandingQuestionsByUser").hasClass("questions-selected")||searchFunction(),updateCounts()}),io.on("answer-rated",function(e){e.answeredBy._id==$("#user-id").val()&&updateUserScore(!0),updateCounts()}),io.on("question-created",function(e){var t="New question created in the section ["+e.type+"] by "+e.user;notificate(t,e.question,e.icon)}),io.on("question-answered",function(e){var t="Question made by "+e.question.createdBy+" answered in the section ["+e.question.type+"] by "+e.user;e.question.createdBy==$("#user-name").val()&&(t="Your question has been answered by "+e.question.updatedBy.username),notificate(t,e.question,e.question.updatedBy.google?e.question.updatedBy.google.picture:"")});var i=$("#question");i.focus(),$("#btn-ask").popover({html:!0}),$("body").tooltip({selector:".panel-user"}),configureEvents(),updateCounts(),initiateSearch(),handleListGroup(),$(".notifications span").tooltip(),window.addEventListener("paste",processPasteEvent)});var searchFunction;$.xhrPool=[],$.xhrPool.abortAll=function(){$(this).each(function(e,t){t.abort()}),$.xhrPool.length=0};
function rateUp(e,t){rate(e,t,"up")}function rateDown(e,t){rate(e,t,"down")}function rate(e,t,n){var a="/answer/"+e;jQuery.ajax({url:a,global:!1,type:"PUT",data:{answer:t,rate:n},success:function(e){$("#"+e._id).html(e.useful),io.emit("answer-rated",{answeredBy:e.user}),updateCounts(),updateUserScore(!0)}})}function onEditAnswerClicked(e,t){$("#editAnswerModal").modal(),$.ajax({url:"/question/"+e,global:!1}).done(function(e){openEditAnswerPopup(e,t)})}function openEditAnswerPopup(e,t){var n=$(".textarea","#editAnswerModal");n.wysiwyg();var a=_.where(e.solutions,{_id:t});n.html(_.first(a).content),$(".edit-question-btn-save").on("click",function(){_.each(e.solutions,function(e){e._id==t&&(e.content=$(".textarea","#editAnswerModal").html())}),updateQuestion({id:e._id,solutions:e.solutions},onEditAnswerCompleted)})}function onDeleteAnswerClicked(e,t){var n="/answer/"+e;jQuery.ajax({url:n,global:!1,type:"DELETE",data:{answer:t},success:function(){updateCounts(),dispatchRefreshQuestions()}})}function answer(){var e=$(".list-group-item-question.active"),t=e.data("id"),n="/question/"+t;$.get(n,function(t){t.solutions.push({content:$(".textarea",e).html()}),registerAnswer(t)})}function registerAnswer(e){var t=$(".list-group-item-question.active");e.read=!1;var n=t.data("id"),a="/question/"+n;jQuery.ajax({url:a,type:"PUT",data:e,success:function(e){$(".textarea",t).html(""),t.removeClass("active"),$(".answer-collapsible.in").collapse("toggle");var n=e.question;io.emit("question-answered",{user:$("#user-name").val(),question:{id:n._id,type:n.type,createdBy:n.user.username,updatedBy:e.updatedBy}}),updateCounts(),dispatchRefreshQuestions()}})}function onEditAnswerCompleted(){onEditCompleted("#editAnswerModal")}var AnswersBox=React.createClass({displayName:"AnswersBox",render:function(){return React.createElement("div",{className:"answer-collapsible collapse",id:"answer-for-"+this.props.questionForAnswer.id},React.createElement(AnswerList,{questionForAnswer:this.props.questionForAnswer}),React.createElement(AnswerPanel,null))}}),AnswerList=React.createClass({displayName:"AnswerList",render:function(){var e=this.props.questionForAnswer.id,t=this.props.questionForAnswer.answers.map(function(t){var n={questionId:e,data:t};return React.createElement(Answer,{key:t._id,answer:n})});return React.createElement("div",{className:"list-group-answers"},t)}}),Answer=React.createClass({displayName:"Answer",render:function(){return React.createElement("div",{className:"list-group"},React.createElement("div",{"data-id":this.props.answer.data._id,className:"list-group-item list-group-item-answer"},React.createElement(AnswerRating,{answer:this.props.answer}),React.createElement(AnswerActions,{answer:this.props.answer}),React.createElement(AnswerContent,{answer:this.props.answer})))}}),AnswerRating=React.createClass({displayName:"AnswerRating",handleThumbUp:function(e){rateUp(e.questionId.toString(),e.data._id.toString())},handleThumbDown:function(e){rateDown(e.questionId.toString(),e.data._id.toString())},render:function(){var e={"float":"right"};return React.createElement("div",{style:e},React.createElement("span",{onClick:this.handleThumbDown.bind(this,this.props.answer),className:"glyphicon glyphicon-thumbs-down thumbs trigger-action"}),React.createElement("span",{id:this.props.answer.data._id,className:"badge rate-badge"},this.props.answer.data.useful),React.createElement("span",{onClick:this.handleThumbUp.bind(this,this.props.answer),className:"glyphicon glyphicon-thumbs-up thumbs"}))}}),AnswerActions=React.createClass({displayName:"AnswerActions",onAnswerEditClicked:function(e,t){onEditAnswerClicked(e.questionId.toString(),e.data._id.toString()),$(t.currentTarget).closest(".list-group-item-answer").addClass("selected")},onAnswerDeleteClicked:function(e){onDeleteAnswerClicked(e.questionId.toString(),e.data._id.toString())},render:function(){var e=this.props.answer,t=e.data.user&&e.data.user.google?e.data.user.google.picture:"img/unknown.png",n=e.data.user.username==$("#user-name").val(),a={"float":"left"};return React.createElement("div",{style:a},React.createElement(If,{condition:n},React.createElement("span",{"data-toggle":"modal",onClick:this.onAnswerEditClicked.bind(this,e),"data-target":"#editAnswerModal",className:"glyphicon glyphicon-pencil"})),React.createElement(If,{condition:n},React.createElement("span",{"data-toggle":"modal",onClick:this.onAnswerDeleteClicked.bind(this,e),className:"glyphicon glyphicon-trash"})),React.createElement("img",{"data-toggle":"dropdown",className:"no-collapse img-responsive answer-user beautify-tooltip img-circle",src:t,alt:""}))}}),AnswerContent=React.createClass({displayName:"AnswerContent",render:function(){var e=this.props.answer.data;return React.createElement("div",null,React.createElement("label",{className:"list-group-item-heading"},e.user.username+" "+toDateTime(e.created)),React.createElement("p",{className:"list-group-item-text",dangerouslySetInnerHTML:{__html:e.content}}))}}),AnswerPanel=React.createClass({displayName:"AnswerPanel",handleAnswerClick:function(){answer()},render:function(){return React.createElement("div",{className:"panel-answer"},React.createElement("div",{className:"textarea","data-ph":"Your answer goes here...",contenteditable:"true"}),React.createElement("div",{className:"panel-bottom-answer"},React.createElement("button",{onClick:this.handleAnswerClick,className:"btn btn-default btn-answer",type:"submit"},i18n.t("main-page.question-panel.register"))))}});
var DashboardBox=React.createClass({displayName:"DashboardBox",render:function(){return React.createElement("div",{id:"dashboard-box"},React.createElement(DashboardContent,{data:this.props.data}),React.createElement(DashboardRank,{users:this.props.data.users}))}}),DashboardContent=React.createClass({displayName:"DashboardContent",buildTagsPanel:function(e){return 0==e.length?React.createElement("h6",null,"No items to show"):e.map(function(e){return React.createElement(Tag,{tag:e})},this)},render:function(){var e={paddingBottom:"17px;"};return React.createElement("div",{id:"dashboard-content"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-lg-9 col-sm-8"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"Overall question data")),React.createElement("div",{className:"panel-body"},React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-warning"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.sinceFirstRelease)),React.createElement("div",{className:"panel-body text-center"},"Since Knowhow release"))),React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-success"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.lastMonthQuestions)),React.createElement("div",{className:"panel-body text-center"},"Last month questions"))),React.createElement("div",{className:"col-xs-12 col-md-4"},React.createElement("div",{className:"panel status panel-info"},React.createElement("div",{className:"panel-heading"},React.createElement("h1",{className:"panel-title text-center"},this.props.data.helpedPeople)),React.createElement("div",{className:"panel-body text-center"},"Helped people :)")))))),React.createElement("div",{className:"col-lg-3 col-sm-4"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"More asked tags"),React.createElement("div",{className:"panel-actions"},React.createElement("a",{href:"index.html#",className:"btn-setting"},React.createElement("i",{className:"icon-settings"})),React.createElement("a",{href:"index.html#",className:"btn-minimize"},React.createElement("i",{className:"icon-arrow-up"})),React.createElement("a",{href:"index.html#",className:"btn-close"},React.createElement("i",{className:"icon-close"})))),React.createElement("div",{className:"panel-body",style:e},React.createElement(DashboardTags,{tags:this.props.data.tags}))))))}}),DashboardTags=React.createClass({displayName:"DashboardTags",render:function(){var e=this.props.tags.map(function(e){return React.createElement("div",{className:"token searched-tag"},React.createElement("span",{className:"token-label"},e._id+" ("+e.count+")"))});return React.createElement("div",{className:"tags collapsible-element"},e)}}),DashboardRank=React.createClass({displayName:"DashboardRank",render:function(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-lg-12 col-sm-8"},React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement("h4",null,"Ranking")),React.createElement(DashboardRankTable,{users:this.props.users}))))}}),DashboardRankTable=React.createClass({displayName:"DashboardRankTable",render:function(){var e=this.props.users.map(function(e){return React.createElement("tr",null,React.createElement("td",{className:"h2 description"},e.position),React.createElement("td",{className:"description"},React.createElement("img",{className:"img-circle img-ranking",src:e.photo,alt:""}),React.createElement("span",{className:"h4"},e.name)),React.createElement("td",{className:"h2 description"},React.createElement("span",{className:"sucess points"},e.points)))});return React.createElement("div",{className:"table-responsive"},React.createElement("table",{className:"table table-striped"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null),React.createElement("th",null),React.createElement("th",null,"Points"))),React.createElement("tbody",null,e)))}});
function range(e,t){arguments.length<=1&&(t=e||0,e=0);for(var a=Math.max(t-e,0),n=0,i=new Array(a);a>n;)i[n++]=e,e+=1;return i}var dom=React.DOM,Paginator=React.createClass({displayName:"Paginator",getDefaultProps:function(){return{maxPages:3}},getInitialState:function(){return{page:1}},onClick:function(e){e>this.props.numPages||1>e||(this.props.onClick&&this.props.onClick(e),this.setState({page:e}))},getDisplayCount:function(){return this.props.numPages>this.props.maxPages?this.props.maxPages:this.props.numPages},getPageRange:function(){var e=this.getDisplayCount(),t=this.state.page,a=(t-1)%e,n=t-a,i=this.props.numPages-t;return t>e&&e>i&&(n=this.props.numPages-e+1),range(n,n+e)},preventDefault:function(e){e.preventDefault()},render:function(){var e=this.state.page,t=1===e?"disabled":"",a=e>=this.props.numPages?"disabled":"";return React.DOM.ul({className:"pagination"},React.DOM.li({className:t,onClick:this.onClick.bind(this,e-1)},React.DOM.a({href:"#",onClick:this.preventDefault},React.DOM.i({className:"glyphicon glyphicon-chevron-left"}))),this.getPageRange().map(this.renderPage,this),React.DOM.li({className:a,onClick:this.onClick.bind(this,e+1)},React.DOM.a({href:"#",onClick:this.preventDefault},React.DOM.i({className:"glyphicon glyphicon-chevron-right"}))))},renderPage:function(e,t){var a=this.state.page===e?"active":"";return React.DOM.li({key:t,className:a,onClick:this.onClick.bind(this,e)},React.DOM.a({href:"#",onClick:this.preventDefault},e))}});React.renderComponent(React.createElement(Paginator,{maxPages:"3",numPages:"5"}),document.querySelector("#pagination"));
function getQuestionMade(){return $("#main-navbar").next("div.popover.in").length?{content:$(".detailed-question").html(),tags:$(".detailed-question-popover .tokenfield").length?tidyTagsUp($(".detailed-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}:{content:$("#question").val(),tags:$(".simple-question-popover .tokenfield").length?tidyTagsUp($(".simple-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}}function dispatchRefreshQuestions(){var e=document.createEvent("Event");e.initEvent("refreshQuestions",!0,!0),document.dispatchEvent(e)}var QuestionsBox=React.createClass({displayName:"QuestionsBox",getInitialState:function(){return{data:[],page:1,textSearch:!1,renderDashboard:!1}},refreshQuestions:function(e,t){console.log(this.state.page),$.ajax({url:"/questions/outstandingFilter"+location.search,dataType:"json",data:{searchType:e,page:this.state.page},success:function(e){var a=t?e.records:this.state.data.concat(e.records);this.setState({data:a,renderDashboard:!1}),this.state.page++,this.hasMoreItems(e.pagination.totalPages),handleListGroup(),NProgress.done(),attachClipboardEvent()}.bind(this),error:function(e,t,a){console.error(this.props.url,t,a.toString())}.bind(this)})},hasMoreItems:function(e){this.state.hasMore=this.state.page<=e+1},componentDidMount:function(){window.addEventListener("scroll",this.handleScroll),document.getElementById("main-menu").addEventListener("click",this.handleMainMenuClick),document.addEventListener("refreshQuestions",this.restartData),document.getElementById("question").addEventListener("keyup",this.handleQuestionKeyUp),$("#accordion").delegate(".btn-answer","click",this.handleQuestionAnswered);var e=getParameterByName("id")?"search-by-id":"outstanding-questions";this.refreshQuestions(e)},handleQuestionKeyUp:function(){return this.state.page=1,this.state.textSearch=!0,$.xhrPool.length&&$.xhrPool.abortAll(),""==getQuestionTrimmed()?($(".nav-sidebar").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active"),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden"),$(".searched-tag").removeClass("searched-tag"),void this.restartData()):($("i.glyphicon-search").addClass("hidden"),$("img.icon-loading ").removeClass("hidden"),void this.refreshQuestionsBySearch(!0))},refreshQuestionsBySearch:function(e){$(".nav-sidebar").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active");var t=$.ajax({url:"/question/search",data:buildSearchData(this.state.page),global:!1}).success(function(t){var a=e?t.records:this.state.data.concat(t.records);handleListGroup(),this.setState({data:a,renderDashboard:!1}),this.state.page++,this.hasMoreItems(t.pagination.totalPages),NProgress.done(),attachClipboardEvent(),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden");var s=getTags();jQuery.ajax({url:"/addSearchCount",type:"PUT",global:!1});for(var n=0;n<s.length;n++)$(".tags").find(".token-label").filter(function(){var e=$(this).attr("class");return $(this).attr("class",e.toLowerCase()),$(this).hasClass(s[n].replace(/\s/g,"-"))}).addClass("searched-tag")}.bind(this)).error(function(){});$.xhrPool.push(t)},handleScroll:function(){!this.state.renderDashboard&&$(window).scrollTop()+$(window).height()>=$(document).height()-100&&this.state.hasMore&&(this.state.textSearch?this.refreshQuestionsBySearch(!1):this.refreshQuestions($("#main-menu li.active a").attr("id"),!1))},handleMainMenuClick:function(){$("#example").height(100),this.state.textSearch=!1,"dashboard"==$("#main-menu li.active a").attr("id")?this.handleDashboard():this.restartData()},handleDashboard:function(){$.ajax({url:"/dashboard",dataType:"json",success:function(e){this.setState({data:e,renderDashboard:!0}),NProgress.done()}.bind(this),error:function(e,t,a){console.error(this.props.url,t,a.toString())}.bind(this)})},restartData:function(){this.state.page=1,this.refreshQuestions($("#main-menu li.active a").attr("id"),!0)},render:function(){return React.createElement("div",null,React.createElement(If,{condition:!this.state.renderDashboard},React.createElement("div",{onScroll:this.handleScroll,id:"accordion"},React.createElement(QuestionList,{questions:this.state.data}),React.createElement("div",{className:"loading-modal"}))),React.createElement(If,{condition:this.state.renderDashboard},React.createElement(DashboardBox,{data:this.state.data})))}}),QuestionList=React.createClass({displayName:"QuestionList",render:function(){var e=this.props.questions.map(function(e){return React.createElement(Question,{key:e._id,question:e})},this);return React.createElement("div",{className:"list-group-questions"},e)}}),Question=React.createClass({displayName:"Question",toggle:function(e){$(e.target).hasClass("collapsible-element")&&$(e.currentTarget).children(".answer-collapsible").collapse("toggle")},render:function(){var e={id:this.props.question._id,answers:this.props.question.solutions};return React.createElement("div",{onClick:this.toggle,className:"collapsible-element list-group-item list-group-item-question","data-id":this.props.question._id,"data-parent":"#accordion","data-toggle":"collapse"},React.createElement(QuestionBy,{question:this.props.question}),React.createElement(QuestionActions,{question:this.props.question}),React.createElement(QuestionContent,{content:this.props.question.content}),React.createElement(QuestionSubContent,{question:this.props.question}),React.createElement(AnswersBox,{questionForAnswer:e}))}}),QuestionActions=React.createClass({displayName:"QuestionActions",handleQuestionEditClicked:function(e){openEditQuestionPopup(e)},handleQuestionDeleteClicked:function(e){deleteQuestion(e)},render:function(){var e={"float":"left"},t=this.props.question.user.username==$("#user-name").val();return React.createElement("div",{style:e},React.createElement("span",{className:"no-collapse glyphicon glyphicon-share-alt clip question-action-copy beautify-tooltip",onclick:"onCommentClicked()","data-placement":"right",title:"Copy to clipboard"}),React.createElement(If,{condition:t},React.createElement("span",{className:"no-collapse glyphicon glyphicon-pencil beautify-tooltip",onClick:this.handleQuestionEditClicked.bind(this,this.props.question._id),"data-placement":"right",title:"Edit this question?"})),React.createElement(If,{condition:t},React.createElement("span",{className:"no-collapse glyphicon glyphicon-trash beautify-tooltip","data-placement":"right",title:"Delete this question?",onClick:this.handleQuestionDeleteClicked.bind(this,this.props.question._id)})))}}),QuestionBy=React.createClass({displayName:"QuestionBy",render:function(){var e=this.props.question,t=e.updated?new Date(e.updated).getTime():new Date(e.created).getTime(),a=e.user.google?e.user.google.picture:"img/unknown.png",s={"margin-top":"5px","float":"left","margin-right":"5px"};return React.createElement("div",{className:"navbar-right"},React.createElement("span",{className:"no-collapse label pointer label-success beautify-tooltip",style:s,title:"Created in: "+toDateTime(e.created),"data-placement":"left"},getLastUpdate(t)),React.createElement("img",{"data-toggle":"dropdown",className:"no-collapse img-responsive panel-user beautify-tooltip img-circle",src:a,alt:"","data-placement":"left",title:e.user.username,"data-original-title":"Tooltip on left"}))}}),QuestionContent=React.createClass({displayName:"QuestionContent",render:function(){return React.createElement("h4",{className:"list-group-item-heading collapsible-element",dangerouslySetInnerHTML:{__html:this.props.content}})}}),QuestionSubContent=React.createClass({displayName:"QuestionSubContent",render:function(){var e=this.props.question;return e.tags&&e.tags.length?React.createElement(QuestionTags,{tags:e.tags}):e.solutions.length?React.createElement("p",{className:"list-group-item-text answer-preview-text collapsible-element"},getShortAnswers(e.solutions)):React.createElement("br",{className:"collapsible-element"})}}),QuestionTags=React.createClass({displayName:"QuestionTags",render:function(){var e=this.props.tags.map(function(e){return React.createElement("div",{className:"token Tryout"},React.createElement("span",{className:"token-label "+e.replace(/\s/g,"-")},e))});return React.createElement("div",{className:"tags collapsible-element"},e)}}),If=React.createClass({displayName:"If",render:function(){return this.props.condition?this.props.children:!1}});React.render(React.createElement(QuestionsBox,{url:"/question"}),document.getElementById("example"));