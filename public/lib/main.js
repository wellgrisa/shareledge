function toDateTime(a){if(void 0==a)return"";var b=new Date(a);return void 0==b?"":padLeft(b.getDate())+"/"+padLeft(b.getMonth())+"/"+b.getFullYear()+" "+padLeft(b.getHours())+":"+padLeft(b.getMinutes())}function padLeft(a,b,c){void 0==b&&(b="0"),void 0==c&&(c="2");for(var d="",e=0;c>e;e++)d+=b;return d.substring(0,d.length-a.toString().length)+a}function processPasteEvent(a){for(var b=0;b<a.clipboardData.items.length;b++){var c=a.clipboardData.items[b],d=c.type;if(-1!=d.indexOf("image")){var e=c.getAsFile(),f=new FileReader;f.onload=function(a){uploadAttachment(a.target.result,cleanTextArea)},insertLoadingTextarea(),f.readAsDataURL(e)}else console.log("Not supported: "+d)}}function downloadFile(){jQuery.ajax({type:"POST",url:"/download",global:!1}).done(function(){})}function insertLoadingTextarea(){doInsert($(document.createElement("div")).html('<img class="icon-loading" src="/img/loading.gif" style="display: block;">')[0])}function uploadAttachment(a,b,c){jQuery.ajax({url:"upload",type:"POST",global:!1,data:{img:a},success:function(a){var d;if("png"==a.ext||"jpg"==a.ext||"jpeg"==a.ext)d=new Image,d.src=a.src;else{var e=c.substr(0,c.lastIndexOf("."))||c,f='<button contenteditable="false"  class="attachment-button" type="button" onclick="window.open(\'/download?filename='+e+"&src="+a.fileName+"','_top'); return false;\">"+'<a class="en-ignore" href="/download?filename='+e+"&src="+a.fileName+'" target="_blank">'+'<img border="0" name="26e5ab31-64b1-4513-af11-a1f5610ba81d" src="img/attachment.png" align="left" style="margin-top: -1px;"> '+c+"</a></button>";d=$(document.createElement("div")).html(f)[0]}doInsert(d),b&&b()},error:function(){}})}function HandleSelectionChange(){var a=window.getSelection&&window.getSelection();a&&a.rangeCount>0&&(savedRange=a.getRangeAt(0))}function doInsert(a){var b=window.getSelection&&window.getSelection();if(b&&b.rangeCount>0){var c=b.getRangeAt(0);c.insertNode(a)}}function drop(a){ignoreDrag(a);var b=a.originalEvent.dataTransfer,c=b.files;if(b.files.length>0){var d=c[0],e=new FileReader;e.onload=function(a){return function(b){uploadAttachment(b.target.result,cleanTextArea,a)}}(d.name),insertLoadingTextarea(),e.readAsDataURL(d,"test")}}function cleanTextArea(){for(var a=$(".textarea",".list-group-item-question.active"),b=a.find("img[src*=data], .icon-loading"),c=0;c<b.length;c++)b[c].remove()}function ignoreDrag(a){a.originalEvent.stopPropagation(),a.originalEvent.preventDefault()}function handleListGroup(){var a=$(".list-group-questions");a.delegate(".answer-collapsible","click",function(a){a.stopPropagation()}),a.delegate("span","click",function(){}),a.delegate(".answer-collapsible","shown.bs.collapse",function(){var a=$(".textarea",$(".list-group-item-question.active"));a.wysiwyg(),a.off("drop").on("drop",drop),a.keyup(function(a){a.ctrlKey&&13==a.keyCode&&answer()}),a.eq(0).focus()}),a.delegate(".answer-collapsible","show.bs.collapse",function(){$("#accordion .in").collapse("hide");var a=$(".list-group-item-question.active");a.attr("style"),a.removeClass("list-group-item-highlighted");var c=a.data("id"),d="/question/updateRead/"+c;jQuery.ajax({url:d,global:!1,type:"PUT",success:function(){console.log("sucess"),updateCounts()}})}),a.delegate(".list-group-item-question","click",function(a){var b=$(a.currentTarget).closest(".list-group-questions").children(".active");b.removeClass("active"),$(a.currentTarget).addClass("active")}),$(".pagination").delegate("a","click",paginationClicked)}function onEditAnswerClicked(a){this.event.stopPropagation(),$("#editAnswerModal").modal();var b=$(a).closest(".list-group-item-question").data("id");$(a).closest(".list-group-item-answer").addClass("selected"),$.ajax({url:"/question/"+b,global:!1}).done(function(a){var b=$(".textarea","#editAnswerModal");b.wysiwyg();var c=_.where(a.solutions,{_id:$(".list-group-item-answer.selected").data("id")});b.html(_.first(c).content),$(".edit-question-btn-save").on("click",function(){_.each(a.solutions,function(a){a._id==$(".list-group-item-answer.selected").data("id")&&(a.content=$(".textarea","#editAnswerModal").html())}),$(".list-group-item-answer.selected").removeClass("selected"),updateQuestion({id:a._id,solutions:a.solutions},onEditAnswerCompleted)})})}function onEditClicked(a){this.event.stopPropagation(),$("#edit-question-tokenfield").tokenfield(),$("#editQuestionModal").modal();var b=$(a).parent().data("id");$(".tokenfield").tokenfield("destroy"),$(".tokenfield","#editQuestionModal").tokenfield("disable"),$.ajax({url:"/question/"+b,global:!1}).done(function(a){var b=$(".textarea","#editQuestionModal");b.wysiwyg(),b.html(a.content),updateTags(function(b){$("#edit-question-tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:b.ttAdapter()}]}),$(".tokenfield","#editQuestionModal").tokenfield("setTokens",a.tags)},a.tags),$(".tokenfield","#editQuestionModal").tokenfield("enable"),$(".edit-question-btn-save").on("click",function(){updateQuestion({id:a._id,read:a.read,content:$(".textarea","#editQuestionModal").html(),tags:tidyTagsUp($("#edit-question-tokenfield").tokenfield("getTokensList").split(",")),solutions:a.solutions},onEditQuestionCompleted)})})}function updateTags(a,b){$.ajax({url:"/tags",global:!1}).done(function(c){for(var d=[],e=0;e<c.length;e++)d.push({value:c[e].title});var f=new Bloodhound({local:d,datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.value)},queryTokenizer:Bloodhound.tokenizers.whitespace});f.initialize(),a(f,b)})}function finishTour(){var a="/finishTour/"+$("#user-id").val();jQuery.ajax({url:a,global:!1,type:"PUT",success:function(){console.log("sucess")}})}function refreshQuestions(){$.get("/question",function(a){$(".list-group-questions").html("");for(var b=a.data,c=0;c<b.length;c++)$(".list-group-questions").append(getQuestion(b[c]))})}function refreshQuestionsWith(a){var b=a.records,c=$(".pagination");c.html("");for(var d=1;d<=a.pagination.totalPages;d++)a.pagination.currentPage==d?c.append($("<li/>",{"class":"active"}).append('<a href="#">'+d+"</a></li>")):c.append('<li><a href="#">'+d+"</a></li>");$(".list-group-questions").html("");for(var d=0;d<b.length;d++)$(".list-group-questions").append(getQuestion(b[d]));var e=new ZeroClipboard($(".clip"));e.on("ready",function(){e.on("copy",function(a){var b=a.clipboardData,c=$(a.target).parent().data("id"),d=$(a.target).siblings(".list-group-item-heading").text().replace(/<img [^>]+>/g,"").replace(/<br>/g,""),e=Helper.getDomain();b.setData("text/plain",$.trim(d)+" "+e+"?id="+c)}),e.on("aftercopy",function(){showSimpleNotification("Question copied to clipboard.","img/copy-icon.png")})})}function paginationClicked(){if(!$(this).hasClass("active")){var a=$(this).closest(".pagination").children(".active");a.removeClass("active"),$(this).parent().addClass("active")}searchFunction()}function sidebarClicked(){if($(this).attr("id"),searchFunction=getQuestionsByLink,!$(this).hasClass("active")){var b=$(this).closest(".side-nav").children(".active");b.removeClass("active"),$(this).parent().addClass("active")}$(".pagination").children(".active").removeClass("active"),getQuestionsByLink()}function getQuestionsByLink(){var a=$("li.active > a",".side-nav").attr("id"),b=$("li.active > a",".pagination").html();"my-questions"==a?getOutstandingCountByFilter({filter:{criteria:{user:!0,type:$("#systems").val()},page:b}},refreshQuestionsWith):"my-outstanding-questions"==a?getOutstandingCountByFilter({filter:{criteria:{$or:[{useful:0},{solutions:{$size:0}}],user:!0,type:$("#systems").val()},page:b}},refreshQuestionsWith):"my-answered-questions"==a?getOutstandingCountByFilter({filter:{criteria:{useful:{$gt:0},user:!0,type:$("#systems").val()},page:b}},refreshQuestionsWith):"outstanding-questions"==a?getOutstandingCountByFilter({filter:{criteria:{$or:[{"solutions.useful":0},{solutions:{$size:0}}],type:$("#systems").val()},page:b}},refreshQuestionsWith):"answered-outstanding-questions"==a?getOutstandingCountByFilter({filter:{criteria:{useful:{$gt:0},type:$("#systems").val()},page:b}},refreshQuestionsWith):"all-questions"==a&&getOutstandingCountByFilter({filter:{criteria:{type:$("#systems").val()},page:b}},refreshQuestionsWith)}function getOutstandingCountByFilter(a,b){$.getJSON("/questions/outstandingFilter",a).done(function(a){b(a)}).fail(function(){})}function updateBadge(a,b){var c="#"+a+" .badge";$(c).length?$(c).text(b):$("#"+a).append('<span class="badge" style="margin-left: 5px">'+b+"</span>")}function updateBadges(a){updateBadge("my-questions",a.myQuestions),updateBadge("my-answered-questions",a.myAnsweredQuestions),updateBadge("my-outstanding-questions",a.myOutstandingQuestions),updateBadge("outstanding-questions",a.outstandingQuestions),updateBadge("answered-outstanding-questions",a.answeredOutstandingQuestions),updateBadge("all-questions",a.allQuestions)}function updateQuestion(a,b){var c="/question/"+a.id;jQuery.ajax({url:c,type:"PUT",data:a,success:function(){b()}})}function onEditQuestionCompleted(){onEditCompleted("#editQuestionModal")}function onEditAnswerCompleted(){onEditCompleted("#editAnswerModal")}function onEditCompleted(a){$(".tokenfield",a).tokenfield("setTokens",""),$(".textarea",a).html(""),$(a).modal("hide"),searchFunction(),$(".edit-question-btn-save").off("click")}function ask(a){var b=getQuestionMade();return""==b?(alertUser("danger",i18n.t("main-page.messages.question-required")),void 0):$("#systems").val()?(jQuery.post("/question",{content:b.content,tags:b.tags,type:$("#systems").val()},function(b){alertUser("success",i18n.t("main-page.messages.question-successful")),$("#question").val(""),$(".token").remove(),$(".detailed-question").html(""),a&&$("#main-navbar").popover("hide"),$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),initiateSearch(),io.emit("question-created",{user:$("#user-name").val(),type:$("#systems").val(),question:{id:b._id,type:b.type},icon:$("#user-avatar").attr("src")}),updateCounts(),updateUserScore(!0),ga_event("Question","Ask","Question saved as outstading")}),void 0):(alertUser("danger",i18n.t("main-page.messages.system-required")),void 0)}function updateUserScore(a){$.ajax({url:"/score/"+$("#user-id").val(),global:!1}).done(function(b){updateScore(b.points);var c=b.points-$("#user-points").val();$("#user-points").val(b.points),a&&c>0&&showSimpleNotification("Congratulations, you have got "+c+" points.","img/star.png")})}function updateScore(a){$(".score").html(a)}function alertUser(a,b){var c=buildPanel(a,b);$(".alert-panel").append(c),setTimeout(function(){$(".alert",".alert-panel").fadeOut("slow")},2e3)}function buildPanel(a,b){var c=[];return c.push('<div class="alert alert-'+a+'">'),c.push('<a href="#" class="close" data-dismiss="alert">&times;</a>'),c.push(b),c.push("</div>"),c.join("")}function answer(){var a=$(".list-group-item-question.active"),b=a.data("id"),c="/question/"+b;$.get(c,function(b){b.solutions.push({content:$(".textarea",a).html()}),registerAnswer(b)})}function updateCounts(){$.ajax({url:"/counts",global:!1}).done(function(a){updateBadges(a.data)})}function initiateSearch(){$(".side-nav").children(".active").removeClass("active"),$("#outstanding-questions").parent().addClass("active");var a=$("li.active > a",".pagination").html();return searchFunction=getQuestionsByLink,""!=getParameterByName("id")?(getOutstandingCountByFilter({filter:{criteria:{_id:getParameterByName("id")},page:a}},refreshQuestionsWith),void 0):(getOutstandingCountByFilter({filter:{criteria:{$or:[{"solutions.useful":0},{solutions:{$size:0}}],type:$("#filter").val()},page:a}},refreshQuestionsWith),void 0)}function registerAnswer(a){var b=$(".list-group-item-question.active");a.read=!1;var c=b.data("id"),d="/question/"+c;jQuery.ajax({url:d,type:"PUT",data:a,success:function(a){$(".text-area-answer",b).val("");var e=a.question;io.emit("question-answered",{user:$("#user-name").val(),question:{id:e._id,type:e.type,createdBy:e.user.username,updatedBy:a.updatedBy}}),$.get("/counts",function(a){updateBadges(a.data)}),updateUserScore(!0),searchFunction()}})}function deleteQuestion(a){this.event.stopPropagation();var b="/question/"+a;jQuery.ajax({url:b,type:"DELETE",data:question,success:function(){updateUserScore(!1),searchFunction(),io.emit("update-counts")}})}function showAnswer(){var b=$(".list-group-item-question.active").data("id"),c="/question/updateRead/"+b;jQuery.ajax({url:c,type:"PUT",success:function(){console.log("sucess")}});var d="/question/"+b;$.get(d,function(a){$("#answers").html("");for(var d=0;d<a.solutions.length;d++){var e='<div class="panel panel-default"><div class="panel-heading"><span class="badge">'+a.solutions[d].useful+"</span><label>"+a.solutions[d].user.username+"</label> "+toDateTime(a.solutions[d].created)+"<a onclick=\"rateUp('"+a.solutions[d]._id+'\')" class="answer-result green" href="#"><span class="glyphicon glyphicon-ok"></span></a></div>'+'<div class="panel-body">'+a.solutions[d].content+"</div>"+"</div>";$("#answers").append(e)}}),$(".answer-panel").fadeIn("slow")}function rateUp(a){rate(a,"up")}function rateDown(a){rate(a,"down")}function rate(a,b){var c="/answer/"+$(".list-group-item-question.active").data("id");jQuery.ajax({url:c,global:!1,type:"PUT",data:{answer:a,rate:b},success:function(a){$("#"+a._id).html(a.useful),io.emit("answer-rated",{answeredBy:a.user}),updateCounts(),updateUserScore(!0)}})}function deleteAnswer(a){var b="/answer/"+$(".list-group-item-question.active").data("id");jQuery.ajax({url:b,global:!1,type:"DELETE",data:{answer:a},success:function(){updateCounts(),searchFunction()}})}function question(a,b,c){return"<a onclick=\"showAnswer('"+a+'\')" href="#" class="list-group-item-question ">'+'<h4 class="list-group-item-heading">'+b+"</h4>"+'<p class="list-group-item-text">'+c+"</p></a>"}function getShortAnswers(a){for(var b="",c=0;c<a.length;c++)b+=$($.parseHTML(a[c].content)).text();var d="...";return b.length<=120&&(d=""),b.substr(0,120)+d}function configureEventHandlers(){var a=$(".list-group-questions");a.delegate(".list-group-item-question","click",function(a){var b=$(a.currentTarget),c="/question/"+b.data("id");$.get(c,function(a){var d,c=b.find(".answers");c.html("");for(var e=0;e<a.solutions.length;e++)d=[],d.push('<div class="panel panel-default">'),d.push('    <div class="panel-heading">'),d.push('        <span class="badge">'+a.solutions[e].useful+"</span>"),d.push("        <label>"+a.solutions[e].user.username+"</label>"),d.push("        "+toDateTime(a.solutions[e].created)),d.push("        <a onclick=\"rateUp('"+a.solutions[e]._id+'\')" class="answer-result green" href="#">'),d.push('            <span class="glyphicon glyphicon-ok"></span>'),d.push("        </a>"),d.push("    </div>"),d.push('    <div class="panel-body">'),d.push("   "+a.solutions[e].content),d.push("    </div>"),d.push("</div>"),c.append(d.join(""))})})}function getLastUpdate(a){var b=(new Date).getTime()-a;b/=1e3;var c=Math.floor(b%60);b/=60;var d=Math.floor(b%60);b/=60;var e=Math.floor(b%24),f=Math.floor(b/24);return f>0?f+" days":e>0&&24>e?e+" hours":d>0&&60>d?d+" minutes":c+" seconds"}function getQuestion(a){var b=[],c="answer-for-"+a._id,d="";a.read||a.user.username==$("#user-name").val()&&(d="list-group-item-highlighted");var e=a.user.google?a.user.google.picture:"/img/unknown.png",f=a.updated?new Date(a.updated).getTime():new Date(a.created).getTime();if(b.push('<div data-target="#'+c+'" class="list-group-item list-group-item-question '+d+'" data-parent="#accordion" data-toggle="collapse" data-id="'+a._id+"\" onclick=\"ga_event('Question', 'Open-Question-"+a._id+"', 'Show details from question')\">"),b.push('<div class="navbar-right">'),b.push('<span class="label label-success" style="margin-top: 5px; float: left;margin-right: 5px">'+getLastUpdate(f)+"</span>"),b.push('<img data-toggle="dropdown" class="img-responsive panel-user img-circle" src="'+e+'" alt="" data-toggle="tooltip" data-placement="left" title="'+a.user.username+'" data-original-title="Tooltip on left"/>'),b.push("</div>"),b.push('<span class="glyphicon glyphicon-share-alt clip" onclick="onCommentClicked()" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;" title="Copy to clipboard"></span>'),a.user.username==$("#user-name").val()&&(b.push('<span data-toggle="modal" onclick="onEditClicked(this)" data-target="#editQuestionModal" class="glyphicon glyphicon-pencil" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),b.push("<span onclick=\"deleteQuestion('"+a._id+'\')" class="glyphicon glyphicon-trash" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>')),b.push('  <h4 class="list-group-item-heading">'+a.content+"</h4>"),a.tags.length){b.push('<div class="tags">');for(var g=0;g<a.tags.length;g++)b.push('<div class="token '+a.tags[g].replace(/\s/g,"-")+'"><span class="token-label" style="max-width: 941px;">'+a.tags[g]+" </span></div>");b.push("</div>")}else a.solutions.length?b.push('  <p class="list-group-item-text answer-preview-text">'+getShortAnswers(a.solutions)+"</p>"):b.push("<br>");b.push('  <div class="answer-collapsible collapse"  id="'+c+'">');for(var g=0;g<a.solutions.length;g++)b.push('<div class="list-group">'),b.push('<div data-id="'+a.solutions[g]._id+'" class="list-group-item list-group-item-answer">'),b.push("<span onclick=\"rateDown('"+a.solutions[g]._id+'\')" class="glyphicon glyphicon-thumbs-down" style="float: right;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),b.push('<span id="'+a.solutions[g]._id+'" class="badge" style="margin-right: 5px">'+a.solutions[g].useful+"</span>"),b.push("<span onclick=\"rateUp('"+a.solutions[g]._id+'\')" class="glyphicon glyphicon-thumbs-up" style="float: right;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),a.solutions[g].user.username==$("#user-name").val()&&(b.push('<span data-toggle="modal" onclick="onEditAnswerClicked(this)" data-target="#editAnswerModal" class="glyphicon glyphicon-pencil" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>'),b.push('<span data-toggle="modal" onclick="deleteAnswer(\''+a.solutions[g]._id+'\')" class="glyphicon glyphicon-trash" style="float: left;font-size: 15px;cursor: pointer;margin-right: 5px;"></span>')),b.push('<label class="list-group-item-heading">'+a.solutions[g].user.username+" "+toDateTime(a.solutions[g].created)+"</label>"),b.push('<p class="list-group-item-text">'+a.solutions[g].content+"</p>"),b.push("</div>"),b.push("</div>");return"hours"!=$("#systems").val()&&"peopleCare"!=$("#systems").val()?b.push(buildAnswerPanel()):"administrative"==$("#department").val()&&b.push(buildAnswerPanel()),b.push("</div>"),b.push("</div>"),b.join(""),b.join("")}function buildAnswerPanel(){var a=[];return a.push('<div class="panel-answer">'),a.push('<div class="textarea" data-ph="Your answer goes here..."></div>'),a.push('<div class="panel-bottom-answer">'),a.push('<button onclick="answer()" class="btn btn-default btn-answer" type="submit">Register</button>'),a.push("</div>"),a.push("</div>"),a.join("")}function buildQuestionPanel(){var b=[];return b.push('<div class="panel-detailed-question">'),b.push('<div class="detailed-question textarea" data-ph="Your question goes here..."></div>'),b.push('<div class="panel-bottom-question">'),b.push('<div class="input-group">'),b.push('<input type="text" id="tags" class="tokenfield" title="Tag here" class="form-control" placeholder="Tag here">'),b.push('<span class="input-group-btn"><button onclick="ask(true)" class="btn btn-info" type="submit">'+i18n.t("main-page.header.ask")+"</button></span>"),b.push("</div>"),b.push("</div>"),b.join("")}function buildTagPanel(){var a=[];return a.push('<div class="input-group">'),a.push('<input type="text" class="tokenfield" name="question" title="Tag here" class="form-control" placeholder="Tag here">'),a.push('<span class="input-group-btn"><button onclick="ask()" class="btn btn-info btn-ask">'+i18n.t("main-page.question-panel.register")+"?</button></span>"),a.push("</div>"),a.join("")}function handleCollapsibleAnswers(a){var b=$(a.currentTarget).parent(".list-group-item-question"),c=b.data("id"),d="/question/"+c;$.get(d,function(a){var d,c=b.find("#answer-for-"+a._id);c.html("");for(var e=0;e<a.solutions.length;e++)d=[],d.push('<div class="panel panel-default">'),d.push('    <div class="panel-heading">'),d.push('        <span class="badge">'+a.solutions[e].useful+"</span>"),d.push("        <label>"+a.solutions[e].user.username+"</label>"),d.push("        "+toDateTime(a.solutions[e].created)),d.push("        <a onclick=\"rateUp('"+a.solutions[e]._id+'\')" class="answer-result green" href="#">'),d.push('            <span class="glyphicon glyphicon-ok"></span>'),d.push("        </a>"),d.push("    </div>"),d.push('    <div class="panel-body">'),d.push("   "+a.solutions[e].content),d.push("    </div>"),d.push("</div>"),c.append(d.join(""))})}function getQuestionMade(){return $("#main-navbar").next("div.popover.in").length?{content:$(".detailed-question").html(),tags:$(".detailed-question-popover .tokenfield").length?tidyTagsUp($(".detailed-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}:{content:$("#question").val(),tags:$(".simple-question-popover .tokenfield").length?tidyTagsUp($(".simple-question-popover .tokenfield").tokenfield("getTokensList").split(",")):""}}function tidyTagsUp(a){for(var b=0;b<a.length;b++)a[b]=$.trim(a[b]);return a}function handleDetailedQuestionPopover(){var a=$("#main-navbar"),b=$("#question");a.on("hide.bs.popover",function(){$("#main-navbar").next().hasClass("popover")&&(b.removeAttr("disabled"),$("#btn-ask").removeAttr("disabled","disabled").addClass("btn-info").removeClass("btn-default"))}).on("shown.bs.popover",function(){$(".panel-detailed-question").is(":visible")&&$(".panel-detailed-question").closest(".popover.in").length&&(b.attr("disabled","disabled"),$("#btn-ask").attr("disabled","disabled").toggleClass("btn-info").toggleClass("btn-default"));var c=$(".detailed-question");c.wysiwyg(),""!=b.val()&&c.html(b.val()),c.focus(),c.keyup(function(a){return window.event?event:a,a.ctrlKey&&13==a.keyCode?(ask(!0),void 0):(getBySearch(),void 0)})})}function configureEvents(){handleDetailedQuestionPopover(),$(".navbar-fixed-top").on("shown.bs.popover",function(){updateTags(function(a){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:a.ttAdapter()}]})})}),$("#question").keyup(function(a){var b=window.event?event:a;13==b.keyCode&&(tagging(),$(".btn-ask").focus()),searchFunction=getBySearch,getBySearch()})}function getBySearch(){""==$("#question").val()&&($(".side-nav").children(".active").removeClass("active"),$("#all-questions").parent().addClass("active")),$.xhrPool.length&&$.xhrPool.abortAll(),$("i.glyphicon-search").addClass("hidden"),$("img.icon-loading ").removeClass("hidden");var a=$.ajax({url:"/question/search",data:buildSearchData(),global:!1}).done(function(a){refreshQuestionsWith(a),$("i.glyphicon-search").removeClass("hidden"),$("img.icon-loading ").addClass("hidden");var b=getTags();jQuery.ajax({url:"/addSearchCount",type:"PUT",global:!1});for(var c=0;c<b.length;c++)$(".tags").children().filter(function(){var a=$(this).attr("class");return $(this).attr("class",a.toLowerCase()),$(this).hasClass(b[c].replace(/\s/g,"-"))}).addClass("searched-tag")});$.xhrPool.push(a)}function requestPermission(){"Notification"in window&&"denied"!==Notification.permission&&Notification.requestPermission(function(a){Notification.permission!==a&&(Notification.permission=a)})}function onNotificationClicked(a){$('[data-id="'+a+'"]').addClass("list-group-item-highlighted"),window.focus()}function notificate(a,b,c){"Notification"in window&&("granted"===Notification.permission?showNotification(a,b,c):"denied"!==Notification.permission&&Notification.requestPermission(function(d){"permission"in Notification||(Notification.permission=d),"granted"===d&&showNotification(a,b,c)}))}function showNotification(a,b,c){if($("#systems").val()==b.type){var d=new Notification(a,{icon:c});setTimeout(function(){d.close()},7e3),d.onclick=function(){onNotificationClicked(b.id)}}}function showSimpleNotification(a,b){if("Notification"in window){var c=new Notification(a,{icon:b});setTimeout(function(){c.close()},7e3),c.onclick=function(){onNotificationClicked(question.id)}}}function askDetailedQuestion(){var a=$("#main-navbar"),b=$("#nav-input-wonder").width();$("#nav-input-wonder").next().hasClass("popover")&&$("#nav-input-wonder").popover("hide"),createPopover("detailed-question-popover",a,buildQuestionPanel(b),b)}function tagging(){var a=$("#nav-input-wonder"),b=a.width();createPopover("simple-question-popover",$("#nav-input-wonder"),buildTagPanel(),b)}function createPopover(a,b,c,d){var e=d?'style="max-width : '+d+"px; width :"+d+'px"':"",f='<div class="'+a+' timePickerWrapper popover"'+e+">",g=[f,'<div class="arrow"></div>','<div class="popover-content">',"</div>","</div>"].join("");b.popover({content:c,template:g,placement:"bottom",html:!0,trigger:"manual"}),b.popover("toggle")}function getQuestionTrimmed(){return $.trim(getQuestionMade().content.replace(/<img [^>]+>/g,"").replace(/<br>/g,"")).replace(/ +/g," ").toLowerCase()}function getConditions(){var a=getQuestionTrimmed(),b=a.split(" "),c=Helper.ToRegexArray(b,"content"),d=Helper.ToRegexArray(b,"tags"),e=Helper.ToRegex(a);return[{content:e},{$and:c},{$or:d}]}function getTags(){var a=getQuestionTrimmed();return $.grep(a.split(" "),function(a){return a})}function buildSearchData(){var a=$("li.active > a",".pagination").html(),b=getConditions();return{filter:{criteria:{$or:b,type:$("#systems").val()},page:a,orderby:{useful:-1,updated:-1}}}}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function onCommentClicked(){this.event.stopPropagation()}function visitorSignIn(){$.post("/signin",{username:"Visitante",password:"123"}).always(function(){window.location="/"})}var Helper={ToRegex:function(a,b,c){void 0==c&&(c="i");var d={$regex:a,$options:c};if(void 0==b)return d;var e={};return e[b]=d,e},ToRegexArray:function(a,b){var c=new Array(a.length);for(i=0;i<a.length;i++)c[i]=Helper.ToRegex(a[i],b);return c},getDomain:function(){var a=window.location.href;return a.substring(0,a.indexOf("/",a.indexOf("//")+2)+1)}};$(document).ready(function(){function b(){var a=$("#filter").val().split(","),b=$("#systems");c(b),b.val(a),b.multiselect("refresh")}function c(a){a.multiselect({buttonWidth:"100%",buttonClass:"btn btn-link",nonSelectedText:i18n.t("main-page.header.system-select"),onChange:d})}function d(){jQuery.ajax({url:"/updateFilter",type:"PUT",global:!1,data:{filter:$("#systems").val()},success:function(){console.log("sucess"),$("#filter").val($("#systems").val()),initiateSearch(),updateCounts()}})}requestPermission(),$.ajaxSetup({complete:function(a){var b=$.xhrPool.indexOf(a);b>-1&&$.xhrPool.splice(b,1)}}),$(document).ajaxStart(function(){$("#accordion").addClass("loading")}).ajaxStop(function(){$("#accordion").removeClass("loading")}).ajaxError(function(a,b,c,d){"Not Found"==d&&(window.location="/")}),updateTags(function(a){$(".tokenfield").tokenfield({typeahead:[{highlight:!0,minLength:1},{source:a.ttAdapter()}]})}),i18n&&i18n.init(b),$("#menu-toggle").click(function(a){a.preventDefault(),$("#wrapper").toggleClass("active")}),$("html").on("click",function(a){"popover"!==$(a.target).data("toggle")&&0===$(a.target).parents('[data-toggle="popover"]').length&&0===$(a.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")}),$(".side-nav a").on("click",sidebarClicked),io=io.connect(),io.on("update-counts",function(){$(".answer-collapsible.in").length||""!=getQuestionTrimmed()||$("#outstandingQuestionsByUser").hasClass("questions-selected")||searchFunction(),updateCounts()}),io.on("answer-rated",function(a){a.answeredBy._id==$("#user-id").val()&&updateUserScore(!0),updateCounts()}),io.on("question-created",function(a){var b="New question created in the section ["+a.type+"] by "+a.user;notificate(b,a.question,a.icon)}),io.on("question-answered",function(a){var b="Question made by "+a.question.createdBy+" answered in the section ["+a.question.type+"] by "+a.user;a.question.createdBy==$("#user-name").val()&&(b="Your question has been answered by "+a.question.updatedBy.username),notificate(b,a.question,a.question.updatedBy.google?a.question.updatedBy.google.picture:"")});var a=$("#question");a.focus(),$("#btn-ask").popover({html:!0}),$("body").tooltip({selector:".panel-user"}),configureEvents(),updateCounts(),initiateSearch(),handleListGroup(),$(".notifications span").tooltip(),window.addEventListener("paste",processPasteEvent)});var searchFunction;$.xhrPool=[],$.xhrPool.abortAll=function(){$(this).each(function(a,b){b.abort()}),$.xhrPool.length=0};